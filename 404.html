<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

<title>BRAIAIN â€” Can You Spot the AI?</title>

<meta name="description" content="Daily AI detection game. 10 rounds. Are you looking at a real photo or an AI fake? Test your instincts.">
<meta name="robots" content="index, follow">
<link rel="canonical" href="https://braiain.com/">

<meta property="og:type" content="website">
<meta property="og:site_name" content="BRAIAIN">
<meta property="og:title" content="BRAIAIN â€” Can You Spot the AI?">
<meta property="og:description" content="Daily AI detection challenge. Can you tell what's real?">
<meta property="og:url" content="https://braiain.com">
<meta property="og:image" content="https://braiain.com/og-image.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="BRAIAIN â€” Can You Spot the AI?">
<meta name="twitter:description" content="Daily AI detection challenge. Can you tell what's real?">
<meta name="twitter:image" content="https://braiain.com/og-image.png">

<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="manifest" href="/site.webmanifest">
<meta name="theme-color" content="#00e5ff">
<meta name="msapplication-TileColor" content="#0a0e17">

<!-- GA4 -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3B3ZCE62NW"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-3B3ZCE62NW');</script>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESET & BASE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#06060c;--surface:#0c0c18;--border:#1a1a2e;
  --cyan:#00e5ff;--green:#00ff9d;--red:#ff003c;--amber:#ffb300;
  --text:#e0e0e0;--muted:#5a5a7a;
  --font-display:'Orbitron',sans-serif;
  --font-mono:'Share Tech Mono',monospace;
  --glow-cyan:0 0 20px rgba(0,229,255,.3);
  --glow-green:0 0 20px rgba(0,255,157,.3);
  --glow-red:0 0 20px rgba(255,0,60,.3);
}
html{font-size:16px;-webkit-tap-highlight-color:transparent}
body{
  background:var(--bg);color:var(--text);
  font-family:var(--font-mono);
  min-height:100dvh;overflow-x:hidden;
  display:flex;flex-direction:column;
}
button{font-family:inherit;cursor:pointer;border:none;background:none;color:inherit}
img{display:block;max-width:100%}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CRT SCANLINE OVERLAY
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#crt-overlay{
  position:fixed;inset:0;pointer-events:none;z-index:9999;
  background:repeating-linear-gradient(
    0deg,
    rgba(0,0,0,.03) 0px,
    rgba(0,0,0,.03) 1px,
    transparent 1px,
    transparent 3px
  );
  mix-blend-mode:multiply;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HUD â€” TOP BAR
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#hud{
  position:sticky;top:0;z-index:100;
  background:rgba(6,6,12,.92);
  backdrop-filter:blur(12px);
  border-bottom:1px solid var(--border);
  padding:10px 16px;
  display:flex;flex-wrap:wrap;align-items:center;
  gap:6px 16px;
}
#hud-logo{
  font-family:var(--font-display);font-weight:900;
  font-size:1.3rem;letter-spacing:4px;color:var(--cyan);
  text-shadow:var(--glow-cyan);
  flex-shrink:0;
}
#hud-ticker{
  font-size:.85rem;color:var(--muted);
  letter-spacing:1px;text-transform:uppercase;
}
#hud-round{
  margin-left:auto;
  font-family:var(--font-display);font-size:.85rem;
  color:var(--cyan);letter-spacing:2px;
}
#hud-pips{display:flex;gap:4px;margin-left:8px}
.pip{
  width:10px;height:10px;border-radius:50%;
  background:var(--border);transition:background .3s,box-shadow .3s;
}
.pip.correct{background:var(--green);box-shadow:var(--glow-green)}
.pip.wrong{background:var(--red);box-shadow:var(--glow-red)}
@media(max-width:480px){
  #hud-ticker{order:3;width:100%;margin-top:2px}
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCREENS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.screen{
  display:none;flex-direction:column;align-items:center;
  flex:1;padding:20px 16px 40px;
  animation:fadeUp .4s ease-out;
}
.screen.active{display:flex}
@keyframes fadeUp{
  from{opacity:0;transform:translateY(20px)}
  to{opacity:1;transform:translateY(0)}
}

/* â”€â”€ BOOT SCREEN â”€â”€ */
#screen-boot{justify-content:center;gap:20px;text-align:center}
#boot-logo{
  font-family:var(--font-display);font-weight:900;
  font-size:clamp(2rem,8vw,3.5rem);
  letter-spacing:6px;color:var(--cyan);
  text-shadow:var(--glow-cyan);
}
#boot-sub{font-size:.75rem;color:var(--muted);letter-spacing:2px;text-transform:uppercase}
#boot-status{font-size:.7rem;color:var(--green);min-height:1.2em}
.boot-btn{
  margin-top:12px;padding:14px 40px;
  font-family:var(--font-display);font-size:.85rem;font-weight:700;
  letter-spacing:3px;text-transform:uppercase;
  color:var(--bg);background:var(--cyan);
  border:none;position:relative;
  clip-path:polygon(8px 0,100% 0,calc(100% - 8px) 100%,0 100%);
  transition:background .2s,transform .1s;
}
.boot-btn:hover{background:var(--green)}
.boot-btn:active{transform:scale(.97)}

/* â”€â”€ GAME SCREEN â”€â”€ */
#screen-game{gap:20px;max-width:960px;width:100%;margin:0 auto}

/* Image container */
#image-frame{
  position:relative;width:100%;
  aspect-ratio:4/3;overflow:hidden;
  border:1px solid var(--border);
  background:var(--surface);
}
#image-frame img{
  width:100%;height:100%;object-fit:cover;
  transition:opacity .3s;
}
#image-frame.loading img{opacity:0}
#scan-line{
  position:absolute;left:0;width:100%;height:2px;
  background:linear-gradient(90deg,transparent,var(--cyan),transparent);
  box-shadow:0 0 12px var(--cyan);
  top:0;opacity:0;pointer-events:none;
  animation:none;
}
@keyframes scanDown{
  0%{top:0;opacity:1}
  100%{top:100%;opacity:.4}
}
#image-frame.scanning #scan-line{animation:scanDown 1.2s ease-in-out forwards}

/* Magnifier */
#magnifier{
  position:absolute;width:140px;height:140px;
  border-radius:50%;border:2px solid var(--cyan);
  box-shadow:var(--glow-cyan);
  pointer-events:none;display:none;
  background-repeat:no-repeat;
  z-index:10;
}

/* Question prompt */
#prompt{
  text-align:center;font-size:1rem;
  color:var(--muted);letter-spacing:2px;
  text-transform:uppercase;
}

/* HUMAN / AI Buttons */
#choices{display:flex;gap:16px;width:100%;max-width:560px}
.choice-btn{
  flex:1;padding:20px 8px;
  font-family:var(--font-display);font-size:1.1rem;font-weight:700;
  letter-spacing:4px;text-transform:uppercase;
  border:2px solid var(--border);
  background:rgba(12,12,24,.6);
  transition:all .2s;position:relative;overflow:hidden;
}
.choice-btn::before{
  content:'';position:absolute;inset:0;
  opacity:0;transition:opacity .2s;
}
.choice-btn.human{color:var(--green)}
.choice-btn.human::before{background:rgba(0,255,157,.08)}
.choice-btn.human:hover,.choice-btn.human:active{
  border-color:var(--green);box-shadow:var(--glow-green);
}
.choice-btn.human:hover::before{opacity:1}
.choice-btn.ai{color:var(--red)}
.choice-btn.ai::before{background:rgba(255,0,60,.08)}
.choice-btn.ai:hover,.choice-btn.ai:active{
  border-color:var(--red);box-shadow:var(--glow-red);
}
.choice-btn.ai:hover::before{opacity:1}
.choice-btn:disabled{opacity:.3;pointer-events:none}

/* â”€â”€ REVEAL PANEL â”€â”€ */
#reveal-panel{
  width:100%;max-width:960px;
  animation:fadeUp .35s ease-out;
  display:none;flex-direction:column;gap:16px;
}
#reveal-panel.active{display:flex}
#reveal-verdict{
  text-align:center;padding:16px;
  font-family:var(--font-display);font-size:1.1rem;
  font-weight:700;letter-spacing:3px;
  border:1px solid var(--border);
}
#reveal-verdict.correct{color:var(--green);border-color:var(--green);background:rgba(0,255,157,.05)}
#reveal-verdict.wrong{color:var(--red);border-color:var(--red);background:rgba(255,0,60,.05)}
#reveal-source{font-size:.85rem;color:var(--muted);text-align:center}
#reveal-tip{
  font-size:.9rem;line-height:1.6;
  padding:14px 16px;
  border-left:2px solid var(--cyan);
  background:rgba(0,229,255,.04);
  color:var(--text);
}
#reveal-tip strong{color:var(--cyan);font-weight:400}
#global-bar-wrap{
  display:flex;align-items:center;gap:10px;
  font-size:.7rem;color:var(--muted);
}
#global-bar{
  flex:1;height:6px;background:var(--border);overflow:hidden;
}
#global-bar-fill{
  height:100%;background:var(--cyan);width:0%;
  transition:width .6s ease-out;
}
#global-label{min-width:80px;text-align:right}
.next-btn{
  align-self:center;padding:12px 32px;
  font-family:var(--font-display);font-size:.75rem;font-weight:700;
  letter-spacing:3px;text-transform:uppercase;
  color:var(--bg);background:var(--cyan);
  clip-path:polygon(6px 0,100% 0,calc(100% - 6px) 100%,0 100%);
  transition:background .2s;
}
.next-btn:hover{background:var(--green)}

/* â”€â”€ RESULTS SCREEN â”€â”€ */
#screen-results{justify-content:center;gap:20px;text-align:center;max-width:520px;margin:0 auto}

/* Score Ring */
#score-ring-wrap{position:relative;width:160px;height:160px}
#score-ring-wrap svg{transform:rotate(-90deg)}
.ring-bg{fill:none;stroke:var(--border);stroke-width:8}
.ring-fg{
  fill:none;stroke:var(--cyan);stroke-width:8;
  stroke-linecap:round;
  stroke-dasharray:440;stroke-dashoffset:440;
  transition:stroke-dashoffset 1.2s ease-out,stroke .3s;
}
#score-center{
  position:absolute;inset:0;
  display:flex;flex-direction:column;
  align-items:center;justify-content:center;
}
#score-num{
  font-family:var(--font-display);font-weight:900;
  font-size:2.2rem;color:var(--cyan);
}
#score-label{font-size:.65rem;color:var(--muted);letter-spacing:2px;text-transform:uppercase}
#results-title{
  font-family:var(--font-display);font-size:1.1rem;
  font-weight:700;letter-spacing:2px;color:var(--text);
}
#results-streak{font-size:.75rem;color:var(--muted)}

/* Results pip grid */
#results-grid{display:flex;gap:6px;justify-content:center;flex-wrap:wrap}
.r-pip{
  width:28px;height:28px;display:flex;
  align-items:center;justify-content:center;
  font-size:.7rem;font-weight:700;
  border:1px solid var(--border);
}
.r-pip.correct{color:var(--green);border-color:var(--green);background:rgba(0,255,157,.08)}
.r-pip.wrong{color:var(--red);border-color:var(--red);background:rgba(255,0,60,.08)}

/* Share buttons */
#share-row{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
.share-btn{
  padding:10px 20px;font-size:.72rem;font-weight:700;
  letter-spacing:2px;text-transform:uppercase;
  border:1px solid var(--border);background:var(--surface);
  transition:all .2s;
}
.share-btn:hover{border-color:var(--cyan);color:var(--cyan)}
#countdown-wrap{font-size:.7rem;color:var(--muted);letter-spacing:1px}
#countdown{color:var(--cyan)}

/* Credit link (reveal panel + review modal) */
.credit-link{
  font-size:.7rem;color:var(--muted);text-align:center;
  letter-spacing:.5px;
}
.credit-link a{
  color:var(--cyan);text-decoration:none;opacity:.7;
  transition:opacity .2s;
}
.credit-link a:hover{opacity:1;text-decoration:underline}

/* Clickable results pips */
.r-pip{cursor:pointer;transition:transform .15s,box-shadow .15s}
.r-pip:hover{transform:scale(1.2)}
.r-pip.correct:hover{box-shadow:var(--glow-green)}
.r-pip.wrong:hover{box-shadow:var(--glow-red)}

/* Review Modal */
#review-modal{
  display:none;position:fixed;inset:0;z-index:300;
  background:rgba(6,6,12,.88);backdrop-filter:blur(8px);
  align-items:center;justify-content:center;
  padding:16px;
}
#review-modal.active{display:flex}
#review-card{
  background:var(--surface);border:1px solid var(--border);
  max-width:520px;width:100%;padding:20px;
  position:relative;
  animation:fadeUp .25s ease-out;
}
#review-close{
  position:absolute;top:10px;right:14px;
  font-size:1.4rem;color:var(--muted);background:none;border:none;
  cursor:pointer;line-height:1;transition:color .2s;
}
#review-close:hover{color:var(--cyan)}
#review-round-label{
  font-family:var(--font-display);font-size:.7rem;
  color:var(--muted);letter-spacing:2px;margin-bottom:12px;
}
#review-card img{
  width:100%;aspect-ratio:4/3;object-fit:cover;
  border:1px solid var(--border);margin-bottom:12px;
}
#review-verdict{
  font-family:var(--font-display);font-size:.9rem;
  font-weight:700;letter-spacing:2px;
  padding:10px;text-align:center;margin-bottom:10px;
  border:1px solid var(--border);
}
#review-verdict.correct{color:var(--green);border-color:var(--green);background:rgba(0,255,157,.05)}
#review-verdict.wrong{color:var(--red);border-color:var(--red);background:rgba(255,0,60,.05)}
#review-attribution{font-size:.78rem;color:var(--muted);text-align:center;margin-bottom:8px}
#review-tip{
  font-size:.82rem;line-height:1.5;padding:10px 12px;
  border-left:2px solid var(--cyan);background:rgba(0,229,255,.04);
  margin-bottom:10px;
}
#review-tip strong{color:var(--cyan);font-weight:400}

/* Toast */
#toast{
  position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(20px);
  padding:10px 24px;background:var(--surface);
  border:1px solid var(--cyan);color:var(--cyan);
  font-size:.75rem;letter-spacing:1px;
  opacity:0;transition:all .3s;z-index:200;pointer-events:none;
}
#toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VERTICAL COLLAPSE TRANSITION
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@keyframes collapseOut{
  0%{opacity:1;transform:scaleY(1)}
  100%{opacity:0;transform:scaleY(0)}
}
@keyframes expandIn{
  0%{opacity:0;transform:scaleY(0)}
  100%{opacity:1;transform:scaleY(1)}
}
.collapse-out{animation:collapseOut .25s ease-in forwards;transform-origin:top}
.expand-in{animation:expandIn .3s ease-out forwards;transform-origin:top}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TEXT SCRAMBLE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.scrambling{color:var(--cyan) !important}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TIP TERMINAL (FOOTER)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.tip-terminal{
  text-align:center;padding:24px 16px 20px;
  border-top:1px solid rgba(0,229,255,.15);margin-top:auto;
}
.tip-terminal .tip-label{
  font-family:var(--font-display);font-size:.55rem;
  letter-spacing:3px;color:var(--cyan);margin-bottom:10px;opacity:.7;
}
.tip-keys{display:flex;gap:10px;justify-content:center;margin-bottom:8px}
.tip-key{
  padding:8px 20px;font-family:var(--font-mono);font-size:.65rem;
  letter-spacing:1px;font-weight:700;
  border:1px solid rgba(0,229,255,.25);background:rgba(0,229,255,.05);
  color:var(--cyan);opacity:.8;
  transition:all .25s;cursor:pointer;
}
.tip-key:hover{opacity:1;border-color:var(--cyan);box-shadow:var(--glow-cyan)}
.tip-key:active{transform:scale(.95)}
.tip-key.copied{opacity:1;color:var(--green);border-color:var(--green)}
.tip-hint{
  font-family:var(--font-mono);font-size:.48rem;
  color:var(--muted);letter-spacing:1.5px;text-align:center;
  opacity:.6;margin-bottom:8px;
}
.tip-footer-note{
  font-size:.45rem;color:var(--muted);letter-spacing:1px;
  margin-top:10px;opacity:.5;
}
.tip-footer-credit{
  font-size:.38rem;color:var(--bg);letter-spacing:.5px;
  margin-top:6px;opacity:.15;transition:opacity .4s;
}
.tip-footer-credit:hover{opacity:.5}
.tip-footer-credit a{color:inherit;text-decoration:none}
.tip-footer-credit a:hover{color:var(--cyan);opacity:1}
</style>
</head>
<body>

<!-- CRT Overlay -->
<div id="crt-overlay"></div>

<!-- HUD -->
<header id="hud" style="display:none">
  <div id="hud-logo">BRAIAIN</div>
  <div id="hud-ticker">LOADING...</div>
  <div id="hud-round">--/--</div>
  <div id="hud-pips"></div>
</header>

<!-- BOOT SCREEN -->
<main id="screen-boot" class="screen active">
  <div id="boot-logo">BRAIAIN</div>
  <div id="boot-sub">CAN YOU SPOT THE AI?</div>
  <div id="boot-status"></div>
  <button class="boot-btn" id="btn-start" style="display:none" onclick="startGame()">BEGIN SCAN</button>
</main>

<!-- GAME SCREEN -->
<main id="screen-game" class="screen">
  <div id="image-frame">
    <img id="game-img" src="" alt="Analyze this image" draggable="false">
    <div id="scan-line"></div>
    <div id="magnifier"></div>
  </div>
  <div id="prompt">CLASSIFY: HUMAN OR AI-GENERATED?</div>
  <div id="choices">
    <button class="choice-btn human" onclick="choose('human')">HUMAN</button>
    <button class="choice-btn ai" onclick="choose('ai')">AI</button>
  </div>
  <div id="reveal-panel">
    <div id="reveal-verdict"></div>
    <div id="reveal-source"></div>
    <div id="reveal-tip"></div>
    <div id="reveal-credit"></div>
    <div id="global-bar-wrap">
      <span>GLOBAL ACCURACY</span>
      <div id="global-bar"><div id="global-bar-fill"></div></div>
      <span id="global-label">ESTABLISHING CONNECTION</span>
    </div>
    <button class="next-btn" onclick="nextRound()">NEXT SCAN â†’</button>
  </div>
</main>

<!-- RESULTS SCREEN -->
<main id="screen-results" class="screen">
  <div id="score-ring-wrap">
    <svg viewBox="0 0 160 160" width="160" height="160">
      <circle class="ring-bg" cx="80" cy="80" r="70"/>
      <circle class="ring-fg" id="ring-fg" cx="80" cy="80" r="70"/>
    </svg>
    <div id="score-center">
      <div id="score-num">0</div>
      <div id="score-label">OF 10</div>
    </div>
  </div>
  <div id="results-title"></div>
  <div id="results-streak"></div>
  <div id="results-grid"></div>
  <div id="share-row">
    <button class="share-btn" onclick="shareClipboard()">ğŸ“‹ COPY</button>
    <button class="share-btn" onclick="shareX()">ğ• SHARE</button>
  </div>
  <div id="countdown-wrap">NEXT CHALLENGE IN <span id="countdown">--:--:--</span></div>
</main>

<!-- Toast -->
<div id="toast"></div>

<!-- Review Modal (results screen pip tap) -->
<div id="review-modal" onclick="closeReview(event)">
  <div id="review-card">
    <button id="review-close" onclick="closeReview()">&times;</button>
    <div id="review-round-label"></div>
    <img id="review-img" src="" alt="Round image">
    <div id="review-verdict"></div>
    <div id="review-attribution"></div>
    <div id="review-tip"></div>
    <div id="review-credit"></div>
  </div>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONFIG
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const API_BASE = 'https://api.braiain.com';
const TOTAL_ROUNDS = 10;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let dailyData = null;
let currentRound = 0;
let results = [];
let streak = 0;
let bestStreak = 0;
let gameActive = false;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FALLBACK DATA â€” Hardcoded reliable Unsplash IDs
   If daily.json fails to load, use these.
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const FALLBACK = {
  day_number: 0,
  date: 'offline',
  category: 'Image Detection',
  category_emoji: 'ğŸ‘ï¸',
  rounds: [
    {
      id:'d1r01',type:'image',source:'human',
      content:'https://picsum.photos/id/167/800/600',
      attribution:'Real photograph â€” urban cityscape at night',
      pro_tip:'LIGHT BLEED: Real neon and city lights create natural lens flare, chromatic aberration, and uneven glow. AI tends to render light sources as clean, uniform halos without the messy physics of real optics.',
      credit_name:'Susan Yin',
      source_url:'https://unsplash.com/photos/2JIvboGLeho'
    },
    {
      id:'d1r02',type:'image',source:'human',
      content:'https://picsum.photos/id/429/800/600',
      attribution:'Real photograph â€” humanoid robot in studio',
      pro_tip:'MECHANICAL JOINTS: Real robots have visible seams, screws, and manufacturing marks. AI-generated robots often have impossibly smooth transitions between parts and joints that couldn\'t physically articulate.',
      credit_name:'Alex Knight',
      source_url:'https://unsplash.com/photos/2EJCSULRwC8'
    },
    {
      id:'d1r03',type:'image',source:'ai',
      content:'https://picsum.photos/id/338/800/600',
      attribution:'AI-generated â€” digital artwork created with Midjourney',
      pro_tip:'UNCANNY PERFECTION: This image has a \'too polished\' quality. Real photos always have sensor noise, subtle motion blur, and optical imperfections. AI images are suspiciously pristine across the entire frame.',
      credit_name:'Midjourney via Unsplash',
      source_url:'https://unsplash.com/photos/U1gvhqVQ2kQ'
    },
    {
      id:'d1r04',type:'image',source:'human',
      content:'https://picsum.photos/id/29/800/600',
      attribution:'Real photograph â€” food styling and fresh vegetables',
      pro_tip:'ORGANIC CHAOS: Real food has natural imperfections â€” a leaf slightly wilted, sauce dripped asymmetrically, crumbs scattered randomly. AI food looks suspiciously art-directed with impossible uniformity.',
      credit_name:'Anna Pelzer',
      source_url:'https://unsplash.com/photos/IGfIGP5ONV0'
    },
    {
      id:'d1r05',type:'image',source:'ai',
      content:'https://picsum.photos/id/240/800/600',
      attribution:'AI-generated â€” cyberpunk digital environment',
      pro_tip:'PHYSICS VIOLATIONS: Check shadows and reflections. AI frequently places light sources inconsistently â€” shadows may point in conflicting directions, and reflections don\'t match the objects casting them.',
      credit_name:'Markus Spiske',
      source_url:'https://unsplash.com/photos/ahi73ZN5P0Y'
    },
    {
      id:'d1r06',type:'image',source:'human',
      content:'https://picsum.photos/id/36/800/600',
      attribution:'Real photograph â€” rain-soaked neon street scene',
      pro_tip:'WATER BEHAVIOR: Real rain on real surfaces creates complex, irregular reflections with natural distortion. AI renders water as either too perfect (mirror-like) or too uniform (repeated ripple patterns).',
      credit_name:'Jezael Melgoza',
      source_url:'https://unsplash.com/photos/layMbSJ3YOE'
    },
    {
      id:'d1r07',type:'image',source:'ai',
      content:'https://picsum.photos/id/64/800/600',
      attribution:'AI-generated â€” photorealistic portrait',
      pro_tip:'BOUNDARY ARTIFACTS: Zoom into where hair meets background or skin meets fabric. AI creates subtle smearing, impossible blending, or haloing effects at these transition zones.',
      credit_name:'AI Generator via Unsplash',
      source_url:'https://unsplash.com/photos/portrait-ai-generated'
    },
    {
      id:'d1r08',type:'image',source:'human',
      content:'https://picsum.photos/id/122/800/600',
      attribution:'Real photograph â€” laptop with screen glow in dark environment',
      pro_tip:'SCREEN LIGHT: Real screens cast uneven light that falls off naturally with distance and bounces differently off varied surfaces. AI often renders screen glow as a uniform wash of color.',
      credit_name:'Ales Nesetril',
      source_url:'https://unsplash.com/photos/Im7lZjxeLhg'
    },
    {
      id:'d1r09',type:'image',source:'ai',
      content:'https://picsum.photos/id/274/800/600',
      attribution:'AI-generated â€” fantasy environment',
      pro_tip:'REPETITION PATTERNS: Count similar elements â€” leaves, bricks, clouds. AI creates subtle copy-paste repetition that nature never produces. Real scenes have true randomness in every repeated element.',
      credit_name:'AI Generator via Unsplash',
      source_url:'https://unsplash.com/photos/fantasy-ai-landscape'
    },
    {
      id:'d1r10',type:'image',source:'human',
      content:'https://picsum.photos/id/164/800/600',
      attribution:'Real photograph â€” retro tech and circuit boards',
      pro_tip:'MANUFACTURING DETAIL: Real electronics have consistent trace widths, solder joints with natural irregularity, and dust/wear marks. AI circuit boards often have traces that lead nowhere and components that don\'t exist.',
      credit_name:'Lorenzo Herrera',
      source_url:'https://unsplash.com/photos/p0j-mE6mGo4'
    }
  ]
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TEXT SCRAMBLE EFFECT
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const GLYPHS = '!@#$%^&*()_+-=[]{}|;:,.<>?/~`Î”Î£Î©Î»Î¼Ï€';
function scrambleText(el, finalText, duration = 600) {
  return new Promise(resolve => {
    el.classList.add('scrambling');
    const len = finalText.length;
    const steps = 12;
    let step = 0;
    const iv = setInterval(() => {
      step++;
      const progress = step / steps;
      let display = '';
      for (let i = 0; i < len; i++) {
        if (i / len < progress) {
          display += finalText[i];
        } else {
          display += GLYPHS[Math.floor(Math.random() * GLYPHS.length)];
        }
      }
      el.textContent = display;
      if (step >= steps) {
        clearInterval(iv);
        el.textContent = finalText;
        el.classList.remove('scrambling');
        resolve();
      }
    }, duration / steps);
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BOOT SEQUENCE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function boot() {
  const status = document.getElementById('boot-status');
  const logo = document.getElementById('boot-logo');
  const sub = document.getElementById('boot-sub');

  // Scramble logo
  await scrambleText(logo, 'BRAIAIN', 800);
  await scrambleText(sub, 'CAN YOU SPOT THE AI?', 500);

  // Check for already-played today
  loadStreak();
  const todayKey = getTodayKey();
  const played = localStorage.getItem('braiain_played_' + todayKey);

  // Load daily data: try challenges/YYYY-MM-DD.json â†’ daily.json â†’ FALLBACK
  status.textContent = '> LOADING DAILY CHALLENGE...';
  const todayFile = 'challenges/' + todayKey + '.json';
  let loaded = false;

  // Try date-specific challenge first
  try {
    status.textContent = '> SCANNING ' + todayFile.toUpperCase() + '...';
    const resp = await fetchWithTimeout(todayFile, {}, 5000);
    if (!resp.ok) throw new Error('HTTP ' + resp.status);
    dailyData = await resp.json();
    status.textContent = '> DAY ' + dailyData.day_number + ' â€” ' + (dailyData.category || 'DETECTION').toUpperCase() + ' LOADED';
    loaded = true;
  } catch (e) {
    // Date file not found â€” try generic daily.json
    try {
      status.textContent = '> DATE FILE MISSING â€” TRYING DAILY.JSON...';
      const resp2 = await fetchWithTimeout('daily.json', {}, 5000);
      if (!resp2.ok) throw new Error('HTTP ' + resp2.status);
      dailyData = await resp2.json();
      status.textContent = '> DAY ' + dailyData.day_number + ' â€” ' + (dailyData.category || 'DETECTION').toUpperCase() + ' LOADED';
      loaded = true;
    } catch (e2) {
      // Both failed â€” use hardcoded fallback
      dailyData = FALLBACK;
      status.textContent = '> OFFLINE MODE â€” USING CACHED DATA';
    }
  }

  await sleep(400);

  if (played) {
    // Already played â€” show results
    try {
      const saved = JSON.parse(localStorage.getItem('braiain_results_' + todayKey));
      if (saved && saved.length) {
        results = saved;
        currentRound = TOTAL_ROUNDS;
        showResults();
        return;
      }
    } catch (e) {}
  }

  document.getElementById('btn-start').style.display = '';
  status.textContent = '> READY â€” ' + dailyData.rounds.length + ' TARGETS QUEUED';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GAME FLOW
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function haptic(pattern) {
  if (!navigator.vibrate) return;
  switch (pattern) {
    case 'tap':     navigator.vibrate(8);  break;
    case 'correct': navigator.vibrate([10, 30, 10]); break;
    case 'wrong':   navigator.vibrate([40, 20, 40]); break;
    case 'finish':  navigator.vibrate([10, 20, 10, 20, 30]); break;
    default:        navigator.vibrate(10);
  }
}

function startGame() {
  haptic('tap');
  gameActive = true;
  currentRound = 0;
  results = [];
  showScreen('screen-game');
  document.getElementById('hud').style.display = '';
  updateHUD();
  loadRound();
}

function loadRound() {
  if (currentRound >= TOTAL_ROUNDS || currentRound >= dailyData.rounds.length) {
    endGame();
    return;
  }

  const round = dailyData.rounds[currentRound];
  const frame = document.getElementById('image-frame');
  const img = document.getElementById('game-img');
  const revealPanel = document.getElementById('reveal-panel');
  const choices = document.getElementById('choices');

  // Reset UI
  revealPanel.classList.remove('active');
  revealPanel.style.display = 'none';
  choices.style.display = '';
  document.querySelectorAll('.choice-btn').forEach(b => b.disabled = false);
  frame.classList.remove('scanning');
  frame.classList.add('loading');

  // Load image
  img.onload = () => {
    frame.classList.remove('loading');
    frame.classList.add('scanning');
    // Enable magnifier after scan
    setTimeout(() => {
      frame.classList.remove('scanning');
      initMagnifier(img);
    }, 1200);
  };
  img.onerror = () => {
    frame.classList.remove('loading');
    // Fallback: try without query params
    if (img.src.includes('?')) {
      img.src = img.src.split('?')[0];
    }
  };
  img.src = round.content;

  // Preload next round's image
  const nextIdx = currentRound + 1;
  if (nextIdx < TOTAL_ROUNDS && nextIdx < dailyData.rounds.length) {
    const preload = new Image();
    preload.src = dailyData.rounds[nextIdx].content;
  }

  // Update prompt
  scrambleText(document.getElementById('prompt'), 'CLASSIFY: HUMAN OR AI-GENERATED?', 300);
  updateHUD();
}

function choose(answer) {
  if (!gameActive) return;

  haptic('tap');

  const round = dailyData.rounds[currentRound];
  const isCorrect = answer === round.source;
  results.push(isCorrect);

  setTimeout(() => haptic(isCorrect ? 'correct' : 'wrong'), 150);

  // Disable buttons
  document.querySelectorAll('.choice-btn').forEach(b => b.disabled = true);

  // Highlight chosen button
  const btns = document.querySelectorAll('.choice-btn');
  btns.forEach(b => {
    if ((answer === 'human' && b.classList.contains('human')) ||
        (answer === 'ai' && b.classList.contains('ai'))) {
      b.style.borderColor = isCorrect ? 'var(--green)' : 'var(--red)';
      b.style.boxShadow = isCorrect ? 'var(--glow-green)' : 'var(--glow-red)';
    }
  });

  // Update pip
  const pips = document.querySelectorAll('.pip');
  if (pips[currentRound]) {
    pips[currentRound].classList.add(isCorrect ? 'correct' : 'wrong');
  }

  // Show reveal
  showReveal(round, isCorrect);

  // Report to API (fire and forget)
  reportVote(round.id, isCorrect);
}

function showReveal(round, isCorrect) {
  const panel = document.getElementById('reveal-panel');
  const verdict = document.getElementById('reveal-verdict');
  const source = document.getElementById('reveal-source');
  const tip = document.getElementById('reveal-tip');
  const choices = document.getElementById('choices');

  verdict.className = 'reveal-verdict ' + (isCorrect ? 'correct' : 'wrong');
  verdict.textContent = isCorrect ? 'âœ“ CORRECT â€” ' + round.source.toUpperCase() : 'âœ— WRONG â€” IT WAS ' + round.source.toUpperCase();

  source.textContent = round.attribution || '';
  tip.innerHTML = '<strong>PRO TIP:</strong> ' + (round.pro_tip || '');

  // Credit link
  const credit = document.getElementById('reveal-credit');
  if (round.credit_name && round.source_url) {
    credit.className = 'credit-link';
    credit.innerHTML = 'ğŸ”— Source: <a href="' + round.source_url + '" target="_blank" rel="noopener">' + round.credit_name + '</a>';
  } else if (round.credit_name) {
    credit.className = 'credit-link';
    credit.textContent = 'ğŸ”— Source: ' + round.credit_name;
  } else {
    credit.textContent = '';
  }

  // Fetch global accuracy
  fetchGlobalAccuracy(round.id);

  // Collapse choices, expand reveal
  choices.style.display = 'none';
  panel.style.display = '';
  panel.classList.add('active');

  // Update next button text on last round
  const nextBtn = panel.querySelector('.next-btn');
  if (currentRound >= TOTAL_ROUNDS - 1 || currentRound >= dailyData.rounds.length - 1) {
    nextBtn.textContent = 'VIEW RESULTS â†’';
  } else {
    nextBtn.textContent = 'NEXT SCAN â†’';
  }
}

function nextRound() {
  haptic('tap');
  currentRound++;
  if (currentRound >= TOTAL_ROUNDS || currentRound >= dailyData.rounds.length) {
    endGame();
  } else {
    loadRound();
  }
}

function endGame() {
  gameActive = false;
  haptic('finish');
  const todayKey = getTodayKey();
  localStorage.setItem('braiain_played_' + todayKey, '1');
  localStorage.setItem('braiain_results_' + todayKey, JSON.stringify(results));

  const score = results.filter(Boolean).length;
  updateStreak(score);
  showResults();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESULTS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showResults() {
  showScreen('screen-results');
  document.getElementById('hud').style.display = 'none';

  const score = results.filter(Boolean).length;
  const titles = [
    'COMPLETELY COMPROMISED','SYSTEM FAILURE','WEAK SIGNAL','PARTIAL DETECTION',
    'HALF MEASURES','MEDIOCRE SCAN','DECENT INSTINCTS','SHARP DETECTOR',
    'ELITE SCANNER','NEAR PERFECT','VOIGHT-KAMPFF MASTER'
  ];

  // Score ring animation
  const ring = document.getElementById('ring-fg');
  const circumference = 2 * Math.PI * 70; // r=70
  const offset = circumference - (score / TOTAL_ROUNDS) * circumference;
  setTimeout(() => {
    ring.style.strokeDashoffset = offset;
    if (score >= 7) ring.style.stroke = 'var(--green)';
    else if (score >= 4) ring.style.stroke = 'var(--cyan)';
    else ring.style.stroke = 'var(--red)';
  }, 100);

  document.getElementById('score-num').textContent = score;
  scrambleText(document.getElementById('results-title'), titles[score], 500);
  document.getElementById('results-streak').textContent =
    streak > 0 ? 'ğŸ”¥ ' + streak + '-day streak | Best: ' + bestStreak : 'Best streak: ' + bestStreak;

  // Pip grid â€” clickable for review
  const grid = document.getElementById('results-grid');
  grid.innerHTML = '';
  results.forEach((c, i) => {
    const pip = document.createElement('div');
    pip.className = 'r-pip ' + (c ? 'correct' : 'wrong');
    pip.textContent = c ? 'âœ“' : 'âœ—';
    pip.onclick = () => openReview(i);
    grid.appendChild(pip);
  });

  startCountdown();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   REVIEW MODAL (tap pip on results screen)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openReview(index) {
  const round = dailyData.rounds[index];
  if (!round) return;

  const isCorrect = results[index];
  const modal = document.getElementById('review-modal');

  document.getElementById('review-round-label').textContent = 'ROUND ' + (index + 1) + ' OF ' + TOTAL_ROUNDS;
  document.getElementById('review-img').src = round.content;

  const verdict = document.getElementById('review-verdict');
  verdict.className = isCorrect ? 'correct' : 'wrong';
  verdict.textContent = isCorrect
    ? 'âœ“ CORRECT â€” ' + round.source.toUpperCase()
    : 'âœ— WRONG â€” IT WAS ' + round.source.toUpperCase();

  document.getElementById('review-attribution').textContent = round.attribution || '';
  document.getElementById('review-tip').innerHTML = '<strong>PRO TIP:</strong> ' + (round.pro_tip || '');

  // Credit link
  const credit = document.getElementById('review-credit');
  if (round.credit_name && round.source_url) {
    credit.className = 'credit-link';
    credit.innerHTML = 'ğŸ”— Source: <a href="' + round.source_url + '" target="_blank" rel="noopener">' + round.credit_name + '</a>';
  } else if (round.credit_name) {
    credit.className = 'credit-link';
    credit.textContent = 'ğŸ”— Source: ' + round.credit_name;
  } else {
    credit.textContent = '';
  }

  modal.classList.add('active');
}

function closeReview(e) {
  if (e && e.target !== document.getElementById('review-modal') && e.target !== document.getElementById('review-close')) return;
  document.getElementById('review-modal').classList.remove('active');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAGNIFIER (Touch + Mouse)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function initMagnifier(img) {
  const frame = document.getElementById('image-frame');
  const mag = document.getElementById('magnifier');
  const zoom = 2.5;
  const magR = 70; // half of 140px magnifier
  const TOUCH_OFFSET = 120; // pixels above finger on touch
  let isTouch = false;

  function show(x, y, offsetY) {
    const rect = frame.getBoundingClientRect();
    const px = (x - rect.left) / rect.width;
    const py = (y - rect.top) / rect.height;
    if (px < 0 || px > 1 || py < 0 || py > 1) { mag.style.display = 'none'; return; }

    // Position loupe â€” centered on mouse, offset above finger on touch
    let loupeX = x - rect.left - magR;
    let loupeY = (y - rect.top - magR) - offsetY;

    // Clamp loupe inside frame
    loupeX = Math.max(0, Math.min(loupeX, rect.width - magR * 2));
    loupeY = Math.max(0, Math.min(loupeY, rect.height - magR * 2));

    mag.style.display = 'block';
    mag.style.left = loupeX + 'px';
    mag.style.top = loupeY + 'px';
    mag.style.backgroundImage = 'url(' + img.src + ')';
    mag.style.backgroundSize = (rect.width * zoom) + 'px ' + (rect.height * zoom) + 'px';
    // Background always tracks actual touch/mouse point (not loupe position)
    mag.style.backgroundPosition =
      (-px * rect.width * zoom + magR) + 'px ' +
      (-py * rect.height * zoom + magR) + 'px';
  }

  function hide() { mag.style.display = 'none'; }

  // Mouse â€” no offset
  frame.onmousemove = e => { isTouch = false; show(e.clientX, e.clientY, 0); };
  frame.onmouseleave = hide;

  // Touch â€” offset above finger
  frame.ontouchstart = e => {
    e.preventDefault();
    isTouch = true;
    if (e.touches.length === 1) {
      const t = e.touches[0];
      show(t.clientX, t.clientY, TOUCH_OFFSET);
    }
  };
  frame.ontouchmove = e => {
    e.preventDefault();
    if (e.touches.length === 1) {
      const t = e.touches[0];
      show(t.clientX, t.clientY, TOUCH_OFFSET);
    }
  };
  frame.ontouchend = hide;
  frame.ontouchcancel = hide;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HUD UPDATES
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function updateHUD() {
  const cat = dailyData ? (dailyData.category_emoji || '') + ' ' + (dailyData.category || '').toUpperCase() : '';
  const dayNum = dailyData ? dailyData.day_number : '--';
  document.getElementById('hud-ticker').textContent = 'DAY ' + dayNum + ' â€” ' + cat;
  document.getElementById('hud-round').textContent = (currentRound + 1) + '/' + TOTAL_ROUNDS;

  // Build pips
  const pipWrap = document.getElementById('hud-pips');
  pipWrap.innerHTML = '';
  for (let i = 0; i < TOTAL_ROUNDS; i++) {
    const p = document.createElement('div');
    p.className = 'pip';
    if (i < results.length) p.classList.add(results[i] ? 'correct' : 'wrong');
    pipWrap.appendChild(p);
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STREAK
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function loadStreak() {
  streak = parseInt(localStorage.getItem('braiain_streak') || '0');
  bestStreak = parseInt(localStorage.getItem('braiain_best_streak') || '0');
  const last = localStorage.getItem('braiain_last_date');
  const today = getTodayKey();
  const yesterday = getYesterdayKey();
  if (last !== today && last !== yesterday) streak = 0;
}

function updateStreak(score) {
  const today = getTodayKey();
  const last = localStorage.getItem('braiain_last_date');
  const yesterday = getYesterdayKey();

  if (score >= 5) {
    if (last === yesterday || !last) streak++;
    else if (last !== today) streak = 1;
  } else {
    streak = 0;
  }
  if (streak > bestStreak) bestStreak = streak;

  localStorage.setItem('braiain_streak', streak);
  localStorage.setItem('braiain_best_streak', bestStreak);
  localStorage.setItem('braiain_last_date', today);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   API
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function reportVote(questionId, wasCorrect) {
  try {
    await fetchWithTimeout(API_BASE + '/vote', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ id: questionId, correct: wasCorrect })
    }, 4000);
  } catch (e) { /* silent */ }
}

async function fetchGlobalAccuracy(questionId) {
  const fill = document.getElementById('global-bar-fill');
  const label = document.getElementById('global-label');
  try {
    const resp = await fetchWithTimeout(API_BASE + '/stats?id=' + questionId, {}, 4000);
    if (!resp.ok) throw new Error();
    const data = await resp.json();
    if (data.total > 0) {
      const pct = Math.round(data.pct);
      fill.style.width = pct + '%';
      label.textContent = pct + '% of ' + data.total + ' players';
      return;
    }
  } catch (e) { /* fall through */ }
  fill.style.width = '0%';
  label.textContent = 'ESTABLISHING CONNECTION';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SHARE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function getShareText() {
  const score = results.filter(Boolean).length;
  const day = dailyData ? dailyData.day_number : '?';
  const grid = results.map(c => c ? 'ğŸŸ©' : 'ğŸŸ¥').join('');
  const lines = [
    'BRAIAIN Day ' + day + ' â€” ' + score + '/' + TOTAL_ROUNDS,
    grid,
    streak > 0 ? 'ğŸ”¥ ' + streak + ' day streak' : '',
    '',
    'Can you spot the AI? â†’ braiain.com'
  ];
  return lines.filter(l => l !== '').join('\n');
}

function shareClipboard() {
  const text = getShareText();
  if (navigator.share) {
    navigator.share({ text }).catch(() => copyFallback(text));
  } else {
    copyFallback(text);
  }
}

function copyFallback(text) {
  navigator.clipboard.writeText(text).then(() => {
    showToast('COPIED TO CLIPBOARD');
  }).catch(() => showToast('COPY FAILED'));
}

function shareX() {
  const text = encodeURIComponent(getShareText());
  window.open('https://twitter.com/intent/tweet?text=' + text, '_blank');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   COUNTDOWN TO NEXT DAY
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function startCountdown() {
  function tick() {
    const now = new Date();
    const tom = new Date(now);
    tom.setUTCDate(tom.getUTCDate() + 1);
    tom.setUTCHours(0, 0, 0, 0);
    const diff = tom - now;
    const h = Math.floor(diff / 3600000);
    const m = Math.floor((diff % 3600000) / 60000);
    const s = Math.floor((diff % 60000) / 1000);
    const el = document.getElementById('countdown');
    if (el) el.textContent = h + 'h ' + String(m).padStart(2, '0') + 'm ' + String(s).padStart(2, '0') + 's';
  }
  tick();
  setInterval(tick, 1000);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UTILITIES
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function getTodayKey() { return new Date().toISOString().split('T')[0]; }
function getYesterdayKey() { return new Date(Date.now() - 86400000).toISOString().split('T')[0]; }
function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

function fetchWithTimeout(url, opts, ms) {
  const ctrl = new AbortController();
  const t = setTimeout(() => ctrl.abort(), ms);
  return fetch(url, { ...opts, signal: ctrl.signal }).finally(() => clearTimeout(t));
}

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2000);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   KEYBOARD SHORTCUTS (Desktop)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.addEventListener('keydown', e => {
  // Game screen: Left = Human, Right = AI
  if (gameActive && document.getElementById('screen-game').classList.contains('active')) {
    const revealActive = document.getElementById('reveal-panel').classList.contains('active');
    if (!revealActive) {
      if (e.key === 'ArrowLeft' || e.key === 'h' || e.key === 'H') { e.preventDefault(); choose('human'); }
      if (e.key === 'ArrowRight' || e.key === 'a' || e.key === 'A') { e.preventDefault(); choose('ai'); }
    } else {
      // Reveal visible: Enter/Space/Right = Next
      if (e.key === 'Enter' || e.key === ' ' || e.key === 'ArrowRight') { e.preventDefault(); nextRound(); }
    }
  }
  // Review modal: Escape to close
  if (e.key === 'Escape') {
    const modal = document.getElementById('review-modal');
    if (modal.classList.contains('active')) { e.preventDefault(); modal.classList.remove('active'); }
  }
  // Boot screen: Enter to start
  if (e.key === 'Enter' && document.getElementById('screen-boot').classList.contains('active')) {
    const btn = document.getElementById('btn-start');
    if (btn && btn.style.display !== 'none') { e.preventDefault(); startGame(); }
  }
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BOOT
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
boot();
</script>

<!-- Tip Terminal -->
<div class="tip-terminal">
  <div class="tip-label">// TIP THE DEVELOPER</div>
  <div class="tip-keys">
    <button class="tip-key" data-chain="eth" onclick="copyTip('eth')">âŸ  ETH</button>
    <button class="tip-key" data-chain="sol" onclick="copyTip('sol')">â— SOL</button>
    <button class="tip-key" data-chain="kas" onclick="copyTip('kas')">â¬¡ KAS</button>
  </div>
  <div class="tip-hint">TAP TO COPY WALLET ADDRESS</div>
  <div class="tip-footer-note">BRAIAIN &copy; 2026 â€” SYSTEM SECURE. NO PERSONAL DATA ARCHIVED.</div>
  <div class="tip-footer-credit">A <a href="mailto:dnilgis@gmail.com">dnilgis</a> Project</div>
</div>

<script>
const TIP_ADDRS = {
  eth: '0x3e3eaf955a6ea978e7694574b14cd8bf082e79cf',
  sol: 'GStGz2ztQ2UqMGPXA8j2i9PSFhpaYsjxwbLTttUKD74d',
  kas: 'kaspa:qps9fumvkw0n29hkjrk7lumpuu64k2u9ug543lg9ga'
};

function copyTip(chain) {
  haptic('tap');
  const addr = TIP_ADDRS[chain];
  const btn = document.querySelector('.tip-key[data-chain="' + chain + '"]');
  navigator.clipboard.writeText(addr).then(() => {
    btn.classList.add('copied');
    btn.textContent = 'âœ“ COPIED';
    showToast(chain.toUpperCase() + ' ADDRESS COPIED');
    setTimeout(() => {
      btn.classList.remove('copied');
      const labels = { eth: 'âŸ  ETH', sol: 'â— SOL', kas: 'â¬¡ KAS' };
      btn.textContent = labels[chain];
    }, 2000);
  }).catch(() => showToast('COPY FAILED'));
}
</script>
</body>
</html>
