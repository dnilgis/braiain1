<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BRAIAIN â€” Challenge Curator</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Orbitron:wght@700;900&display=swap');

  :root {
    --bg: #0a0a0f;
    --surface: #12121a;
    --border: #1e1e2a;
    --text: #e0e0e8;
    --muted: #6a6a7a;
    --cyan: #00e5ff;
    --green: #00ff9d;
    --red: #ff003c;
    --orange: #ff9500;
    --font-mono: 'Space Mono', monospace;
    --font-head: 'Orbitron', monospace;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: var(--bg); color: var(--text);
    font-family: var(--font-mono); font-size: 14px;
    min-height: 100vh; padding: 20px; max-width: 1200px; margin: 0 auto;
  }

  h1 { font-family: var(--font-head); font-size: 1.5rem; color: var(--cyan); letter-spacing: 4px; margin-bottom: 4px; }
  .subtitle { color: var(--muted); font-size: .65rem; letter-spacing: 2px; margin-bottom: 24px; }

  /* Panels */
  .panel {
    background: var(--surface); border: 1px solid var(--border);
    padding: 20px; margin-bottom: 20px; border-radius: 4px;
  }
  .panel h2 {
    font-family: var(--font-head); font-size: .8rem; letter-spacing: 3px;
    margin-bottom: 14px; display: flex; align-items: center; gap: 10px;
  }
  .step-num {
    display: inline-flex; align-items: center; justify-content: center;
    width: 26px; height: 26px; border-radius: 50%; font-size: .65rem;
    font-weight: 900; flex-shrink: 0;
  }

  label { display: block; color: var(--muted); font-size: .6rem; letter-spacing: 1px; margin-bottom: 4px; text-transform: uppercase; }
  input, textarea, select {
    padding: 8px 12px; background: var(--bg); border: 1px solid var(--border);
    color: var(--text); font-family: var(--font-mono); font-size: .8rem;
    border-radius: 2px; outline: none; width: 100%;
  }
  input:focus, textarea:focus { border-color: var(--cyan); }
  .hint { color: var(--muted); font-size: .55rem; margin-top: 3px; }
  .hint a { color: var(--cyan); }
  .row { display: flex; gap: 12px; flex-wrap: wrap; }
  .row > div { flex: 1; min-width: 100px; }

  /* Buttons */
  .btn {
    padding: 10px 20px; font-family: var(--font-head); font-size: .65rem;
    letter-spacing: 2px; cursor: pointer; border: none;
    font-weight: 700; transition: all .2s; display: inline-flex; align-items: center; gap: 8px;
  }
  .btn-cyan { background: var(--cyan); color: var(--bg); }
  .btn-cyan:hover { background: #33ecff; }
  .btn-green { background: var(--green); color: var(--bg); }
  .btn-green:hover { background: #33ffb3; }
  .btn-orange { background: var(--orange); color: var(--bg); }
  .btn-orange:hover { filter: brightness(1.15); }
  .btn-red { background: var(--red); color: white; }
  .btn-outline { background: transparent; color: var(--cyan); border: 1px solid var(--cyan); }
  .btn-outline:hover { background: rgba(0,229,255,.08); }
  .btn-sm { padding: 6px 14px; font-size: .55rem; }
  .btn:disabled { opacity: .35; cursor: not-allowed; }

  /* Search */
  .search-row { display: flex; gap: 8px; margin-bottom: 10px; }
  .search-row input { flex: 1; }

  /* Image grids */
  .img-grid {
    display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 10px; margin-top: 10px;
  }
  .img-card {
    position: relative; background: var(--bg); border: 2px solid var(--border);
    border-radius: 4px; overflow: hidden; cursor: pointer; transition: all .15s;
  }
  .img-card:hover { border-color: var(--cyan); }
  .img-card.selected { border-color: var(--green); box-shadow: 0 0 14px rgba(0,255,157,.2); }
  .img-card img { width: 100%; height: 150px; object-fit: cover; display: block; }
  .img-card .meta { padding: 6px 8px; font-size: .55rem; color: var(--muted); line-height: 1.4; }
  .img-card .meta b { color: var(--text); }
  .img-card .sel-badge {
    position: absolute; top: 5px; right: 5px;
    font-family: var(--font-head); font-size: .5rem;
    padding: 2px 8px; letter-spacing: 1px; font-weight: 700;
    display: none; border-radius: 2px;
  }
  .img-card.selected .sel-badge { display: block; background: var(--green); color: var(--bg); }

  /* Slot strips */
  .slot-strip { display: flex; gap: 8px; overflow-x: auto; padding: 8px 0; }
  .slot {
    flex-shrink: 0; width: 110px; height: 72px; position: relative;
    border-radius: 3px; overflow: hidden;
  }
  .slot img { width: 100%; height: 100%; object-fit: cover; }
  .slot .rm { position: absolute; top: 2px; right: 2px; background: var(--red); color: white;
    border: none; width: 16px; height: 16px; font-size: 9px; cursor: pointer;
    font-family: var(--font-mono); border-radius: 2px; display: flex; align-items: center; justify-content: center; }
  .slot .sn { position: absolute; bottom: 0; left: 0; right: 0;
    background: rgba(0,0,0,.75); text-align: center;
    font-size: .45rem; padding: 2px; letter-spacing: 1px; }
  .slot-empty {
    flex-shrink: 0; width: 110px; height: 72px;
    border: 1px dashed var(--border); border-radius: 3px;
    display: flex; align-items: center; justify-content: center;
    color: var(--muted); font-size: .5rem; letter-spacing: 1px;
  }
  .slot-empty.human { border-color: rgba(0,255,157,.3); color: var(--green); }
  .slot-empty.ai { border-color: rgba(255,0,60,.3); color: var(--red); }

  /* AI prompt cards */
  .ai-card {
    background: var(--bg); border: 1px solid var(--border); border-radius: 4px;
    padding: 14px; margin-bottom: 10px;
  }
  .ai-card .ai-num { font-family: var(--font-head); font-size: .6rem; color: var(--red); letter-spacing: 1px; margin-bottom: 6px; }
  .ai-card textarea { font-size: .75rem; line-height: 1.5; resize: vertical; min-height: 50px; margin-bottom: 8px; }
  .ai-card .actions { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
  .ai-card .preview { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 10px; }
  .ai-card .preview img {
    width: 160px; height: 110px; object-fit: cover; border-radius: 3px;
    border: 2px solid var(--border); cursor: pointer; transition: all .15s;
  }
  .ai-card .preview img:hover { border-color: var(--cyan); }
  .ai-card .preview img.picked { border-color: var(--red); box-shadow: 0 0 10px rgba(255,0,60,.3); }
  .ai-card .tip-row { margin-top: 8px; }
  .ai-card .tip-row input { font-size: .7rem; }

  /* Status */
  .status { color: var(--muted); font-size: .65rem; padding: 4px 0; min-height: 20px; }
  .status.err { color: var(--red); }
  .status.ok { color: var(--green); }

  /* Spinner */
  .spin { display: inline-block; width: 12px; height: 12px; border: 2px solid var(--muted);
    border-top-color: var(--cyan); border-radius: 50%; animation: sp .5s linear infinite; }
  @keyframes sp { to { transform: rotate(360deg); } }

  /* Export */
  #json-out {
    width: 100%; height: 300px; padding: 12px;
    background: var(--bg); border: 1px solid var(--border);
    color: var(--green); font-family: var(--font-mono); font-size: .65rem;
    resize: vertical; outline: none; margin-top: 10px;
  }

  .counter { font-family: var(--font-head); font-size: .7rem; }
  .counter .n { color: var(--cyan); }

  hr { border: none; border-top: 1px solid var(--border); margin: 12px 0; }
</style>
</head>
<body>

<h1>BRAIAIN CURATOR</h1>
<div class="subtitle">FIND 5 REAL PHOTOS + GENERATE 5 AI IMAGES â†’ EXPORT CHALLENGE</div>

<!-- â•â•â• STEP 1: CONFIG â•â•â• -->
<div class="panel">
  <h2><span class="step-num" style="background:var(--cyan);color:var(--bg)">1</span> CHALLENGE CONFIG</h2>
  <div class="row">
    <div style="max-width:80px"><label>Day #</label><input type="number" id="cfg-day" value="2" min="1"></div>
    <div style="max-width:160px"><label>Date</label><input type="date" id="cfg-date" value="2026-02-06"></div>
    <div><label>Category / Theme</label><input type="text" id="cfg-cat" placeholder="e.g. National Pizza Day"></div>
    <div style="max-width:70px"><label>Emoji</label><input type="text" id="cfg-emoji" placeholder="ğŸ•"></div>
  </div>
</div>

<!-- â•â•â• STEP 2: API KEYS â•â•â• -->
<div class="panel">
  <h2><span class="step-num" style="background:var(--orange);color:var(--bg)">2</span> API KEYS (saved in your browser)</h2>
  <div class="row">
    <div>
      <label>Unsplash Access Key</label>
      <input type="text" id="key-unsplash" placeholder="Paste key here">
      <div class="hint">Free â†’ <a href="https://unsplash.com/developers" target="_blank">unsplash.com/developers</a> â†’ New App â†’ copy Access Key</div>
    </div>
    <div>
      <label>Google AI Studio API Key</label>
      <input type="text" id="key-gemini" placeholder="Paste key here">
      <div class="hint">Free tier â†’ <a href="https://aistudio.google.com/app/apikey" target="_blank">aistudio.google.com/app/apikey</a> â†’ Create API Key</div>
    </div>
  </div>
</div>

<!-- â•â•â• STEP 3: REAL PHOTOS â•â•â• -->
<div class="panel">
  <h2><span class="step-num" style="background:var(--green);color:var(--bg)">3</span> <span style="color:var(--green)">REAL PHOTOS</span> â€” PICK 5 FROM UNSPLASH</h2>
  <div class="search-row">
    <input type="text" id="us-query" placeholder="Search photos (e.g. football stadium crowd night)">
    <button class="btn btn-green btn-sm" onclick="searchUnsplash()">SEARCH</button>
  </div>
  <div style="display:flex;justify-content:space-between;align-items:center;">
    <div class="status" id="us-status"></div>
    <div class="counter"><span class="n" id="real-count">0</span>/5 selected</div>
  </div>
  <label style="color:var(--green)">SELECTED</label>
  <div class="slot-strip" id="real-strip"></div>
  <div class="img-grid" id="us-grid"></div>
</div>

<!-- â•â•â• STEP 4: AI IMAGES â•â•â• -->
<div class="panel">
  <h2><span class="step-num" style="background:var(--red);color:white">4</span> <span style="color:var(--red)">AI IMAGES</span> â€” GENERATE 5 WITH GEMINI</h2>
  <p style="color:var(--muted);font-size:.65rem;margin-bottom:12px;">
    Write a prompt for each, click Generate, pick the best result. You can generate multiple times per slot.
    You can also upload an image file instead (e.g. from Gemini web, Midjourney, etc).
  </p>
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
    <div class="status" id="ai-status-global"></div>
    <div class="counter"><span class="n" id="ai-count">0</span>/5 selected</div>
  </div>
  <label style="color:var(--red)">SELECTED</label>
  <div class="slot-strip" id="ai-strip"></div>
  <hr>
  <div id="ai-cards"></div>
</div>

<!-- â•â•â• STEP 5: EXPORT â•â•â• -->
<div class="panel">
  <h2><span class="step-num" style="background:var(--cyan);color:var(--bg)">5</span> EXPORT CHALLENGE</h2>
  <p style="color:var(--muted);font-size:.65rem;margin-bottom:12px;">
    Once you have 5 real + 5 AI images, generate the JSON. Then download everything â€” the JSON goes in
    <code style="color:var(--cyan)">challenges/</code> and AI images go in <code style="color:var(--cyan)">images/</code>.
  </p>
  <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:6px;">
    <button class="btn btn-cyan" onclick="generateJSON()">GENERATE JSON</button>
    <button class="btn btn-green" onclick="downloadAll()">â¬‡ DOWNLOAD ALL</button>
    <button class="btn btn-outline btn-sm" onclick="copyJSON()">COPY JSON</button>
  </div>
  <div class="status" id="export-status"></div>
  <textarea id="json-out" placeholder="Challenge JSON will appear here..."></textarea>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const REAL = [null, null, null, null, null];    // unsplash photo objects
const AI   = [null, null, null, null, null];    // { blob, dataUrl, prompt }
let unsplashResults = [];

// Default prompts (user edits these per challenge)
const prompts = [
  'A photorealistic image of a gold trophy on a podium with dramatic spotlight, dark background, award ceremony setting',
  'A photorealistic image of a packed football stadium at night with bright floodlights and cheering crowd, wide angle shot',
  'A photorealistic image of a red carpet event with photographers, velvet ropes, camera flashes at night',
  'A photorealistic extreme close-up of a leather football on a grass field with morning dew, showing lace details',
  'A photorealistic image of golden confetti falling over a celebration stage with spotlights and silhouettes cheering'
];
const tips = [
  'Check trophy details â€” AI often gets engravings and award shapes wrong.',
  'Look at individual faces in the crowd â€” AI tends to blur them into uniform masses.',
  'Examine the cameras and hands of photographers â€” AI struggles with complex hand positions.',
  'The leather texture looks real, but check where the ball meets the grass â€” AI fumbles contact shadows.',
  'Real confetti has varied shapes and sizes; AI confetti looks too uniform and repetitive.'
];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
window.addEventListener('DOMContentLoaded', () => {
  // Restore saved API keys
  document.getElementById('key-unsplash').value = localStorage.getItem('braiain_key_unsplash') || '';
  document.getElementById('key-gemini').value = localStorage.getItem('braiain_key_gemini') || '';

  // Auto-save keys on change
  document.getElementById('key-unsplash').addEventListener('input', e =>
    localStorage.setItem('braiain_key_unsplash', e.target.value.trim()));
  document.getElementById('key-gemini').addEventListener('input', e =>
    localStorage.setItem('braiain_key_gemini', e.target.value.trim()));

  // Enter to search
  document.getElementById('us-query').addEventListener('keydown', e => {
    if (e.key === 'Enter') searchUnsplash();
  });

  renderRealStrip();
  renderAIStrip();
  renderAICards();
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UNSPLASH â€” REAL PHOTOS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function searchUnsplash() {
  const key = document.getElementById('key-unsplash').value.trim();
  if (!key) return stat('us-status', 'Enter Unsplash key in Step 2', 'err');

  const q = document.getElementById('us-query').value.trim();
  if (!q) return stat('us-status', 'Type a search term', 'err');

  stat('us-status', 'Searchingâ€¦');

  try {
    const r = await fetch(
      `https://api.unsplash.com/search/photos?query=${encodeURIComponent(q)}&per_page=24&orientation=landscape`,
      { headers: { Authorization: `Client-ID ${key}` } }
    );
    if (!r.ok) throw new Error(r.status === 401 ? 'Invalid API key' : 'HTTP ' + r.status);
    const d = await r.json();
    unsplashResults = d.results;
    stat('us-status', `${d.total} results (showing ${unsplashResults.length})`, 'ok');
    renderUSGrid();
  } catch (e) {
    stat('us-status', e.message, 'err');
  }
}

function renderUSGrid() {
  const g = document.getElementById('us-grid');
  g.innerHTML = '';
  unsplashResults.forEach(p => {
    const sel = REAL.some(r => r && r.id === p.id);
    const c = document.createElement('div');
    c.className = 'img-card' + (sel ? ' selected' : '');
    c.innerHTML = `
      <img src="${p.urls.small}" loading="lazy">
      <div class="meta"><b>${p.user.name}</b><br>${(p.alt_description || 'Untitled').slice(0, 55)}</div>
      <div class="sel-badge">âœ“ REAL</div>`;
    c.onclick = () => toggleReal(p);
    g.appendChild(c);
  });
}

function toggleReal(photo) {
  const idx = REAL.findIndex(r => r && r.id === photo.id);
  if (idx >= 0) { REAL[idx] = null; }
  else {
    const empty = REAL.findIndex(r => r === null);
    if (empty < 0) return stat('us-status', 'All 5 slots full â€” remove one first', 'err');
    REAL[empty] = photo;
  }
  renderUSGrid(); renderRealStrip();
}

function removeReal(i) { REAL[i] = null; renderUSGrid(); renderRealStrip(); }

function renderRealStrip() {
  const s = document.getElementById('real-strip');
  s.innerHTML = '';
  let count = 0;
  for (let i = 0; i < 5; i++) {
    if (REAL[i]) {
      count++;
      s.innerHTML += `<div class="slot" style="border:2px solid var(--green)">
        <img src="${REAL[i].urls.thumb}">
        <button class="rm" onclick="removeReal(${i})">âœ•</button>
        <div class="sn" style="color:var(--green)">REAL ${i+1}</div></div>`;
    } else {
      s.innerHTML += `<div class="slot-empty human">REAL ${i+1}</div>`;
    }
  }
  document.getElementById('real-count').textContent = count;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GEMINI â€” AI IMAGES
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderAICards() {
  const wrap = document.getElementById('ai-cards');
  wrap.innerHTML = '';
  for (let i = 0; i < 5; i++) {
    const card = document.createElement('div');
    card.className = 'ai-card';
    card.id = `aic-${i}`;
    card.innerHTML = `
      <div class="ai-num">AI IMAGE ${i+1}</div>
      <textarea id="prompt-${i}" rows="2">${prompts[i]}</textarea>
      <div class="actions">
        <button class="btn btn-orange btn-sm" id="gen-${i}" onclick="geminiGen(${i})">GENERATE</button>
        <button class="btn btn-outline btn-sm" onclick="document.getElementById('up-${i}').click()">UPLOAD FILE</button>
        <input type="file" id="up-${i}" accept="image/*" style="display:none" onchange="handleUpload(${i},event)">
        <span class="status" id="ai-st-${i}"></span>
      </div>
      <div class="preview" id="prev-${i}"></div>
      <div class="tip-row">
        <label>Pro tip (shown after reveal)</label>
        <input id="tip-${i}" value="${tips[i]}">
      </div>`;
    wrap.appendChild(card);
  }
}

async function geminiGen(i) {
  const key = document.getElementById('key-gemini').value.trim();
  if (!key) return stat(`ai-st-${i}`, 'Enter Google AI key in Step 2', 'err');

  const prompt = document.getElementById(`prompt-${i}`).value.trim();
  if (!prompt) return stat(`ai-st-${i}`, 'Write a prompt first', 'err');

  const btn = document.getElementById(`gen-${i}`);
  btn.disabled = true;
  btn.innerHTML = '<span class="spin"></span> WAITâ€¦';
  stat(`ai-st-${i}`, 'Calling Geminiâ€¦');

  try {
    const resp = await fetch(
      `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${key}`,
      {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          contents: [{ parts: [{ text: prompt }], role: 'user' }],
          generationConfig: { responseModalities: ['TEXT', 'IMAGE'] }
        })
      }
    );

    if (!resp.ok) {
      const err = await resp.json().catch(() => ({}));
      throw new Error(err.error?.message || 'HTTP ' + resp.status);
    }

    const data = await resp.json();
    let found = false;
    const prev = document.getElementById(`prev-${i}`);

    if (data.candidates?.[0]?.content?.parts) {
      for (const part of data.candidates[0].content.parts) {
        if (part.inlineData) {
          const mime = part.inlineData.mimeType || 'image/png';
          const b64 = part.inlineData.data;
          const dataUrl = `data:${mime};base64,${b64}`;

          // Make blob
          const bytes = atob(b64);
          const arr = new Uint8Array(bytes.length);
          for (let j = 0; j < bytes.length; j++) arr[j] = bytes.charCodeAt(j);
          const blob = new Blob([arr], { type: mime });

          // Add preview thumbnail (append so user can gen multiple)
          const img = document.createElement('img');
          img.src = dataUrl;
          img.title = 'Click to select';
          img.onclick = () => pickAI(i, blob, dataUrl, prompt, img);
          prev.appendChild(img);

          // Auto-select if slot empty
          if (!AI[i]) pickAI(i, blob, dataUrl, prompt, img);
          found = true;
        }
      }
    }

    if (!found) throw new Error('No image returned â€” try different wording or check quota');
    stat(`ai-st-${i}`, 'Done! Click to select, or generate again for alternatives.', 'ok');
  } catch (e) {
    stat(`ai-st-${i}`, e.message, 'err');
  }

  btn.disabled = false;
  btn.innerHTML = 'GENERATE';
}

function pickAI(i, blob, dataUrl, prompt, imgEl) {
  AI[i] = { blob, dataUrl, prompt };
  const prev = document.getElementById(`prev-${i}`);
  prev.querySelectorAll('img').forEach(im => im.classList.remove('picked'));
  imgEl.classList.add('picked');
  renderAIStrip();
}

function handleUpload(i, e) {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = ev => {
    const dataUrl = ev.target.result;
    AI[i] = { blob: file, dataUrl, prompt: document.getElementById(`prompt-${i}`).value };
    const prev = document.getElementById(`prev-${i}`);
    prev.innerHTML = '';
    const img = document.createElement('img');
    img.src = dataUrl; img.classList.add('picked');
    prev.appendChild(img);
    stat(`ai-st-${i}`, 'Uploaded âœ“', 'ok');
    renderAIStrip();
  };
  reader.readAsDataURL(file);
}

function removeAI(i) { AI[i] = null; renderAIStrip(); }

function renderAIStrip() {
  const s = document.getElementById('ai-strip');
  s.innerHTML = '';
  let count = 0;
  for (let i = 0; i < 5; i++) {
    if (AI[i]) {
      count++;
      s.innerHTML += `<div class="slot" style="border:2px solid var(--red)">
        <img src="${AI[i].dataUrl}">
        <button class="rm" onclick="removeAI(${i})">âœ•</button>
        <div class="sn" style="color:var(--red)">AI ${i+1}</div></div>`;
    } else {
      s.innerHTML += `<div class="slot-empty ai">AI ${i+1}</div>`;
    }
  }
  document.getElementById('ai-count').textContent = count;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EXPORT
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function generateJSON() {
  const day = parseInt(document.getElementById('cfg-day').value) || 1;
  const date = document.getElementById('cfg-date').value;
  const cat = document.getElementById('cfg-cat').value.trim();
  const emoji = document.getElementById('cfg-emoji').value.trim();

  const rc = REAL.filter(Boolean).length;
  const ac = AI.filter(Boolean).length;
  if (rc < 5 || ac < 5) return stat('export-status', `Need 5 real (${rc}) + 5 AI (${ac})`, 'err');

  // Build 10 rounds â€” interleave real and AI in shuffled order
  // Create array of 5 real + 5 AI, then shuffle
  const items = [];

  for (let i = 0; i < 5; i++) {
    const photo = REAL[i];
    items.push({
      source: 'human',
      content: `${photo.urls.raw}&w=800&h=600&fit=crop&q=80`,
      attribution: `Photo by ${photo.user.name} on Unsplash`,
      source_url: photo.links.html,
      pro_tip: 'Natural imperfections like lens flare, slight blur, or uneven lighting are hallmarks of a real photograph.',
      _slotLabel: `Real photo ${i+1}`
    });
  }

  for (let i = 0; i < 5; i++) {
    const ext = AI[i].blob.type?.includes('png') ? 'png' : 'jpg';
    items.push({
      source: 'ai',
      content: `images/d${day}_ai${i+1}.${ext}`,
      attribution: 'AI-generated â€” created with Google Gemini',
      pro_tip: document.getElementById(`tip-${i}`).value || tips[i],
      _prompt: document.getElementById(`prompt-${i}`).value,
      _slotLabel: `AI image ${i+1}`,
      _ext: ext
    });
  }

  // Shuffle
  for (let i = items.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [items[i], items[j]] = [items[j], items[i]];
  }

  // Build rounds
  const rounds = items.map((item, idx) => {
    const r = {
      id: `d${day}r${idx + 1}`,
      type: 'image',
      content: item.content,
      source: item.source,
      attribution: item.attribution,
      pro_tip: item.pro_tip
    };
    if (item.source_url) r.source_url = item.source_url;
    if (item._prompt) r._note = `Prompt: ${item._prompt}`;
    return r;
  });

  const challenge = {
    day_number: day,
    date: date,
    category: cat || 'Daily Challenge',
    category_emoji: emoji || 'ğŸ§ ',
    rounds
  };

  document.getElementById('json-out').value = JSON.stringify(challenge, null, 2);
  stat('export-status', `Done! ${rounds.length} rounds (${rc} real + ${ac} AI, shuffled). Now click DOWNLOAD ALL.`, 'ok');
}

async function downloadAll() {
  const json = document.getElementById('json-out').value;
  if (!json) return stat('export-status', 'Generate JSON first', 'err');

  const day = parseInt(document.getElementById('cfg-day').value) || 1;
  const date = document.getElementById('cfg-date').value;

  stat('export-status', 'Downloading filesâ€¦');

  // Download JSON
  dlBlob(new Blob([json], { type: 'application/json' }), `${date}.json`);

  // Download each AI image
  for (let i = 0; i < 5; i++) {
    if (AI[i]) {
      const ext = AI[i].blob.type?.includes('png') ? 'png' : 'jpg';
      dlBlob(AI[i].blob, `d${day}_ai${i+1}.${ext}`);
      await sleep(350);
    }
  }

  stat('export-status', `Downloaded! Put JSON â†’ challenges/${date}.json, images â†’ images/ folder. Redeploy.`, 'ok');
}

function copyJSON() {
  const ta = document.getElementById('json-out');
  if (!ta.value) return;
  navigator.clipboard.writeText(ta.value);
  stat('export-status', 'Copied to clipboard âœ“', 'ok');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UTILS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function stat(id, msg, type = '') {
  const el = document.getElementById(id);
  if (!el) return;
  el.textContent = msg;
  el.className = 'status' + (type ? ' ' + type : '');
}

function dlBlob(blob, name) {
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = name;
  a.click();
  URL.revokeObjectURL(a.href);
}

function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }
</script>
</body>
</html>
