<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRAIAIN SPEED INDEX</title>
    <meta name="description" content="AI model benchmarks testing Speed, Cost, and Intelligence via the Braiain Composite Score.">
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-3B3ZCE62NW"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-3B3ZCE62NW');
    </script>
    
    <link rel="icon" type="image/png" sizes="32x32" href="favicon.png">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@400;700;900&family=Rajdhani:wght@500;700&display=swap');
        
        :root {
            --bg-deep: #020405;
            --bg-panel: #0a0e12;
            --bg-card: #0d1216;
            --neon-green: #00ff41;
            --neon-dim: rgba(0, 255, 65, 0.1);
            --border-color: #1a2329;
            --text-main: #e0e0e0;
            --text-muted: #888;
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'Share Tech Mono', monospace; 
            background-color: var(--bg-deep); 
            color: var(--text-main);
            min-height: 100vh;
            font-size: 15px;
            background-image: 
                linear-gradient(rgba(0, 255, 65, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 65, 0.03) 1px, transparent 1px);
            background-size: 40px 40px; 
        }

        /* === UTILITIES === */
        .container { max-width: 1400px; margin: 0 auto; padding: 0 20px; }
        .hidden { display: none !important; }
        
        /* === TOOLTIPS (Enhanced ELI5) === */
        [data-tooltip] { position: relative; cursor: help; border-bottom: 1px dotted var(--neon-green); }
        [data-tooltip]::after {
            content: attr(data-tooltip);
            position: absolute;
            visibility: hidden;
            opacity: 0;
            bottom: 100%; left: 50%;
            transform: translateX(-50%) translateY(-10px);
            background: #0a0e12; 
            border: 1px solid var(--neon-green); 
            color: #fff; 
            padding: 15px;
            font-size: 0.85rem; 
            font-family: 'Share Tech Mono', monospace;
            width: max-content; 
            max-width: 350px; 
            z-index: 999999; 
            box-shadow: 0 10px 40px rgba(0,0,0,1); 
            text-align: left; 
            white-space: pre-wrap; 
            line-height: 1.5;
            transition: 0.15s ease-out;
            pointer-events: none;
            border-radius: 4px;
        }
        [data-tooltip]:hover::after { visibility: visible; opacity: 1; transform: translateX(-50%) translateY(-15px); }

        /* === HEADER === */
        header { 
            background: rgba(2, 4, 5, 0.95); 
            border-bottom: 1px solid var(--border-color); 
            padding: 30px 0; 
            position: sticky; top: 0; z-index: 100; 
            backdrop-filter: blur(10px);
        }
        
        .logo-wrapper { display: flex; flex-direction: column; align-items: center; margin-bottom: 20px; }
        
        /* ASCII LOGO (Glitch-Free) */
        .ascii-logo {
            font-family: 'Courier New', Courier, monospace; 
            white-space: pre; 
            font-size: 14px; 
            line-height: 14px; 
            font-weight: 900;
            color: var(--neon-green);
            text-shadow: 0 0 10px rgba(0, 255, 65, 0.6);
            display: block; 
            margin-bottom: 5px;
            transform: scale(1, 1);
        }

        /* HUD */
        .hud-bar {
            display: flex; justify-content: center; gap: 40px;
            background: rgba(0, 255, 65, 0.02); 
            border: 1px solid var(--border-color);
            padding: 10px 30px; 
            border-radius: 4px;
            width: fit-content; margin: 0 auto;
        }
        .hud-stat { display: flex; gap: 8px; align-items: center; }
        .hud-label { color: var(--text-muted); font-size: 0.75rem; letter-spacing: 1px; font-family: 'Orbitron'; }
        .hud-value { color: #fff; font-family: 'Rajdhani'; font-weight: 700; font-size: 1.1rem; }

        /* === AD BANNER === */
        .ad-banner {
            margin: 25px auto; padding: 15px 25px;
            border: 1px dashed var(--border-color); 
            background: linear-gradient(90deg, rgba(0,0,0,0) 0%, rgba(0,255,65,0.05) 50%, rgba(0,0,0,0) 100%);
            display: flex; justify-content: space-between; align-items: center; gap: 20px;
        }
        .ad-text { font-size: 1rem; color: #fff; font-family: 'Orbitron', sans-serif; letter-spacing: 1px; font-weight: bold; }
        .act-btn { 
            display: inline-block; padding: 6px 16px; font-size: 0.8rem; font-weight: bold; 
            border: 1px solid var(--neon-green); color: var(--neon-green); text-decoration: none; 
            background: rgba(0,255,65,0.05); transition: 0.2s; font-family: 'Orbitron', sans-serif;
        }
        .act-btn:hover { background: var(--neon-green); color: #000; box-shadow: 0 0 10px var(--neon-dim); }

        /* === CONTROLS === */
        .controls-bar {
            background: var(--bg-panel); border: 1px solid var(--border-color);
            padding: 15px; margin: 30px 0;
            display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; gap: 15px;
        }
        .btn-group { display: flex; gap: 5px; }
        .ctrl-btn {
            background: transparent; border: 1px solid var(--border-color); color: var(--text-muted);
            padding: 8px 16px; cursor: pointer; font-family: 'Share Tech Mono'; font-size: 0.85rem;
            transition: all 0.2s;
        }
        .ctrl-btn:hover { color: var(--neon-green); border-color: var(--neon-green); }
        .ctrl-btn.active { background: var(--neon-dim); color: var(--neon-green); border-color: var(--neon-green); }

        /* === GRID SYSTEM === */
        .bz-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 30px;
            margin-bottom: 50px;
        }

        .bz-card {
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 20px;
            display: flex; flex-direction: column;
            height: 100%; position: relative;
            transition: transform 0.2s, border-color 0.2s;
        }
        .bz-card:hover { border-color: var(--neon-green); transform: translateY(-3px); box-shadow: 0 5px 20px rgba(0,0,0,0.5); }

        .bz-card-header {
            display: flex; justify-content: space-between; align-items: flex-start;
            margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid var(--border-color);
        }
        .bz-provider { font-family: 'Orbitron'; font-weight: 700; font-size: 1.2rem; color: #fff; }
        .bz-model { font-size: 0.75rem; color: var(--text-muted); display: block; margin-top: 4px; }
        .bz-rank { font-family: 'Rajdhani'; font-size: 1.5rem; color: #333; font-weight: 900; }

        .bz-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .bz-stat-item { display: flex; flex-direction: column; }
        .bz-stat-label { font-size: 0.65rem; color: #666; letter-spacing: 1px; margin-bottom: 2px; }
        .bz-stat-val { font-family: 'Rajdhani'; font-size: 1.3rem; font-weight: 700; color: #eee; }
        .val-good { color: var(--neon-green); text-shadow: 0 0 10px var(--neon-dim); }

        .bz-checks {
            display: flex; justify-content: space-between;
            background: rgba(0,0,0,0.3); padding: 8px 15px; border-radius: 4px;
            margin-bottom: 20px;
        }
        .bz-check-item { text-align: center; }
        .bz-check-lbl { display: block; font-size: 0.6rem; color: #666; margin-bottom: 2px; }
        .icon-ok { color: var(--neon-green); }
        .icon-bad { color: #555; }

        .bz-preview {
            background: #000; border: 1px solid #222;
            padding: 12px; border-radius: 4px;
            margin-bottom: 20px; cursor: pointer; position: relative;
        }
        .bz-preview:hover { border-color: #444; }
        .bz-preview-text {
            color: #888; font-size: 0.75rem; font-family: monospace; line-height: 1.4;
            display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .bz-preview::after {
            content: "CLICK TO EXPAND"; position: absolute; bottom: 0; right: 0;
            background: var(--neon-green); color: #000;
            font-size: 0.6rem; font-weight: bold; padding: 2px 6px;
            opacity: 0; transition: opacity 0.2s;
        }
        .bz-preview:hover::after { opacity: 1; }

        .bz-actions { margin-top: auto; display: flex; gap: 10px; }
        .bz-btn {
            flex: 1; padding: 10px 0; text-align: center;
            font-family: 'Orbitron'; font-size: 0.75rem; font-weight: 700;
            text-decoration: none; cursor: pointer; border-radius: 4px; transition: 0.2s;
        }
        .btn-outline { border: 1px solid #444; color: #888; background: transparent; }
        .btn-outline:hover { border-color: #fff; color: #fff; }
        .btn-fill { background: var(--neon-dim); border: 1px solid var(--neon-green); color: var(--neon-green); }
        .btn-fill:hover { background: var(--neon-green); color: #000; box-shadow: 0 0 15px var(--neon-dim); }

        /* === TABLE VIEW === */
        .bz-table-container {
            overflow-x: auto; border: 1px solid var(--border-color); background: var(--bg-panel);
            border-radius: 4px; margin-bottom: 50px;
        }
        table { width: 100%; border-collapse: collapse; min-width: 1000px; }
        
        th { 
            text-align: left; padding: 15px; background: #05080a; 
            color: var(--neon-green); font-family: 'Orbitron'; font-size: 0.75rem; 
            position: sticky; top: 0; z-index: 10; border-bottom: 2px solid var(--border-color);
        }
        td { padding: 12px 15px; border-bottom: 1px solid #1a2329; vertical-align: top; }
        
        /* Fixed Column Widths */
        th:nth-child(1), td:nth-child(1) { width: 40px; text-align: center; }
        th:nth-child(2), td:nth-child(2) { width: 120px; text-align: left; }
        th:nth-child(3), td:nth-child(3) { width: 140px; text-align: left; }
        th:nth-child(4), td:nth-child(4), th:nth-child(5), td:nth-child(5), th:nth-child(6), td:nth-child(6), th:nth-child(8), td:nth-child(8) { width: 65px; text-align: center; }
        th:nth-child(7), td:nth-child(7) { width: 50px; text-align: center; }
        th:nth-child(9), td:nth-child(9), th:nth-child(10), td:nth-child(10), th:nth-child(11), td:nth-child(11) { width: 45px; text-align: center; }
        th:nth-child(12), td:nth-child(12) { width: auto; text-align: left; padding-right: 15px; }
        th:nth-child(13), td:nth-child(13) { width: 80px; text-align: center; }

        .col-center { text-align: center; }
        .col-check { font-size: 1.1rem; }
        
        .table-preview {
            max-width: 300px; color: #777; font-size: 0.8rem;
            display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical;
            overflow: hidden; text-overflow: ellipsis; cursor: help;
        }
        .table-preview:hover { color: #fff; }

        .table-visit-btn {
            display: inline-block; padding: 4px 10px; border: 1px solid var(--neon-green); color: var(--neon-green);
            text-decoration: none; font-size: 0.7rem; font-weight: bold; font-family: 'Orbitron';
        }
        .table-visit-btn:hover { background: var(--neon-green); color: #000; }

        /* === METHODOLOGY EXPANSION (NEW) === */
        .methodology-box {
            background: var(--bg-panel); border: 1px solid var(--border-color);
            padding: 40px; margin-bottom: 50px; position: relative; overflow: hidden;
        }
        .method-title {
            font-family: 'Orbitron'; font-size: 1.5rem; color: #fff; 
            margin-bottom: 30px; border-bottom: 2px solid var(--neon-green); padding-bottom: 10px; display: inline-block;
        }
        
        .step-container { margin-bottom: 40px; }
        .step-head { 
            display: flex; align-items: center; gap: 15px; margin-bottom: 15px; 
            cursor: help; width: fit-content;
        }
        .step-num { 
            background: var(--neon-dim); color: var(--neon-green); 
            font-family: 'Orbitron'; font-weight: 900; font-size: 1.2rem; 
            width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; 
            border: 1px solid var(--neon-green); border-radius: 50%;
        }
        .step-name { font-family: 'Rajdhani'; font-size: 1.4rem; font-weight: 700; color: #fff; }
        
        .code-block {
            background: #050505; border: 1px solid #333; padding: 20px; 
            font-family: 'Courier New', monospace; font-size: 0.85rem; color: #aaa;
            border-left: 3px solid var(--neon-green); margin-left: 20px;
            white-space: pre-wrap; line-height: 1.5;
        }
        .highlight { color: var(--neon-green); font-weight: bold; }

        .disclaimer-box { 
            background: rgba(255,0,0,0.05); border: 1px solid #331111; 
            padding: 20px; color: #995555; font-size: 0.9rem; 
        }

        /* === MODAL === */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 2000; backdrop-filter: blur(5px);
        }
        .modal-content {
            position: absolute; top: 5%; left: 5%; right: 5%; bottom: 5%;
            background: #0d1117; border: 1px solid var(--neon-green);
            display: flex; flex-direction: column;
            box-shadow: 0 0 50px rgba(0,255,65,0.1);
        }
        .modal-header {
            padding: 20px; border-bottom: 1px solid #333;
            display: flex; justify-content: space-between; align-items: center;
        }
        .modal-body {
            padding: 30px; overflow-y: auto; 
            font-family: monospace; white-space: pre-wrap; color: #ccc;
            font-size: 0.9rem; line-height: 1.6;
        }

        /* === CHART === */
        .chart-container {
            background: var(--bg-panel); border: 1px solid var(--border-color);
            padding: 20px; height: 400px; margin-bottom: 50px;
        }

        /* === FOOTER === */
        footer { border-top: 1px solid var(--border-color); padding: 50px 0; text-align: center; color: #555; }

    </style>
</head>
<body>

<header>
    <div class="container">
        <div class="logo-wrapper">
            <div class="ascii-logo">
 ██████╗ ██████╗  █████╗ ██╗ █████╗ ██╗███╗   ██╗
 ██╔══██╗██╔══██╗██╔══██╗██║██╔══██╗██║████╗  ██║
 ██████╔╝██████╔╝███████║██║███████║██║██╔██╗ ██║
 ██╔══██╗██╔══██╗██╔══██║██║██╔══██║██║██╔══██║
 ██████╔╝██║  ██║██║  ██║██║██║  ██║██║██║ ╚████║
 ╚═════╝ ╚═╝  ╚═╝╚═╝  ╚═╝╚═╝╚═╝  ╚═╝╚═╝╚═╝  ╚═══╝
            </div>
        </div>
        
        <div class="hud-bar">
            <div class="hud-stat"><span class="hud-label">NODES</span><span class="hud-value" id="node-count">--</span></div>
            <div style="opacity:0.3">|</div>
            <div class="hud-stat"><span class="hud-label">STATUS</span><span class="hud-value" style="color:var(--neon-green)">LIVE</span></div>
            <div style="opacity:0.3">|</div>
            <div class="hud-stat"><span class="hud-label">CYCLE</span><span class="hud-value">6H</span></div>
        </div>
    </div>
</header>

<div class="container">
    
    <div class="ad-banner">
        <div class="ad-text">ADVERTISE HERE: Reach thousands of AI developers.</div>
        <a href="mailto:dnilgis@gmail.com" class="act-btn">CONTACT ></a>
    </div>

    <div class="controls-bar">
        <div class="btn-group">
            <button class="ctrl-btn active" id="btn-grid" onclick="setMode('grid')">GRID</button>
            <button class="ctrl-btn" id="btn-list" onclick="setMode('list')">LIST</button>
        </div>
        <div class="btn-group">
            <span style="color:#666; margin-right:10px; font-size:0.8rem; align-self:center;">SORT:</span>
            <button class="ctrl-btn active" id="sort-score" onclick="setSort('score')">SCORE</button>
            <button class="ctrl-btn" id="sort-speed" onclick="setSort('speed')">SPEED</button>
            <button class="ctrl-btn" id="sort-tps" onclick="setSort('tps')">TPS</button>
            <button class="ctrl-btn" id="sort-cost" onclick="setSort('cost')">COST</button>
        </div>
        <div>
            <button class="ctrl-btn" onclick="exportCSV()">CSV</button>
        </div>
    </div>

    <div id="grid-container" class="bz-grid">
        </div>

    <div id="list-container" class="bz-table-container hidden">
        <table>
            <thead>
                <tr>
                    <th class="col-center">RK</th>
                    <th>PROVIDER</th>
                    <th>MODEL</th>
                    <th class="col-center" data-tooltip="Weighted Composite Score (0-100)">SCORE</th>
                    <th class="col-center" data-tooltip="Total Execution Time">SPEED</th>
                    <th class="col-center" data-tooltip="Tokens Per Second">TPS</th>
                    <th class="col-center" data-tooltip="Time to First Token">TTFT</th>
                    <th class="col-center">COST</th>
                    <th class="col-center">JSON</th>
                    <th class="col-center">LOGIC</th>
                    <th class="col-center">CODE</th>
                    <th>OUTPUT (PREVIEW)</th>
                    <th class="col-center">LINK</th>
                </tr>
            </thead>
            <tbody id="table-body">
                </tbody>
        </table>
    </div>

    <div class="chart-container">
        <canvas id="mainChart"></canvas>
    </div>

    <div class="methodology-box">
        <div class="method-title">THE GAUNTLET PROTOCOL</div>
        
        <div class="step-container">
            <div class="step-head" data-tooltip="We simulate a 'Cold Start' by making the AI read ~2,500 characters of text before it can answer. This prevents it from just 'guessing' quickly.">
                <div class="step-num">1</div>
                <div class="step-name">CONTEXT INJECTION (RAG SIMULATION)</div>
            </div>
            <div class="code-block">
INJECTED CONTEXT: "The Story of Ouroboros"
LENGTH: ~2,500 Characters
PURPOSE: Forces the model to process significant input tokens before generating output.
            </div>
        </div>

        <div class="step-container">
            <div class="step-head" data-tooltip="We give the AI three very different jobs to do all at once. This tests if it can follow complex instructions without getting confused.">
                <div class="step-num">2</div>
                <div class="step-name">THE MULTI-STEP PROMPT</div>
            </div>
            <div class="code-block">
<span class="highlight">PART 1 - JSON GENERATION:</span>
"Generate a valid JSON object describing the 'Ouroboros' entity... MUST contain exactly these keys: entity_name, origin, purpose, is_biological."

<span class="highlight">PART 2 - LOGICAL REASONING:</span>
"Solve this riddle: A bat and a ball cost $1.10 in total. The bat costs $1.00 more than the ball. How much does the ball cost?"

<span class="highlight">PART 3 - CODING:</span>
"Write a Python function named `calculate_fibonacci`... Include a docstring and type hints."
            </div>
        </div>

        <div class="step-container">
            <div class="step-head" data-tooltip="We don't just check if the answer is right. We check if it followed formatting rules, if the code actually works, and if the JSON is valid.">
                <div class="step-num">3</div>
                <div class="step-name">AUTOMATED SCORING</div>
            </div>
            <div class="code-block">
QUALITY SCORE (50%):
- Valid JSON Structure? (+35pts)
- Logic Answer = $0.05? (+35pts) (Penalty for $0.10 trap)
- Python Syntax Valid? (+30pts)

SPEED SCORE (30%):
- Normalized against a 20s target time.

RESPONSIVENESS (20%):
- Time to First Token (TTFT) + Output Speed (TPS)
            </div>
        </div>

        <div class="disclaimer-box">
            <strong>DISCLAIMER:</strong> Results are based on live API calls from US-East servers. Performance may vary by region. We are not affiliated with any provider.
        </div>
    </div>

</div>

<footer>
    <div class="ascii-logo footer-logo" style="font-size:10px;">
 ██████╗ ██████╗  █████╗ ██╗ █████╗ ██╗███╗   ██╗
 ██╔══██╗██╔══██╗██╔══██╗██║██╔══██╗██║████╗  ██║
 ██████╔╝██████╔╝███████║██║███████║██║██╔██╗ ██║
 ██╔══██╗██╔══██╗██╔══██║██║██╔══██║██║██╔══██║
 ██████╔╝██║  ██║██║  ██║██║██║  ██║██║██║ ╚████║
 ╚═════╝ ╚═╝  ╚═╝╚═╝  ╚═╝╚═╝╚═╝  ╚═╝╚═╝╚═╝  ╚═══╝
    </div>
    <p>A dnilgis PROJECT</p>
    <br>
    <a href="data.json" style="color:#666; text-decoration:none;">JSON API</a>
</footer>

<div id="modal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h3 style="font-family:'Orbitron'; color:#fff;" id="modal-title">RESPONSE</h3>
            <button onclick="closeModal()" class="ctrl-btn">CLOSE [X]</button>
        </div>
        <div class="modal-body" id="modal-text"></div>
    </div>
</div>

<script>
    // === CONFIGURATION ===
    let appData = null;
    let currentSort = 'score';
    let chartInstance = null;
    const AFFILIATES = {"OpenAI":"https://platform.openai.com/","Google":"https://ai.google.dev/","Anthropic":"https://console.anthropic.com/","Groq":"https://console.groq.com/","Mistral AI":"https://console.mistral.ai/","Cohere":"https://dashboard.cohere.com/","Together AI":"https://api.together.xyz/","DeepSeek":"https://platform.deepseek.com/","Fireworks":"https://fireworks.ai/","Cerebras":"https://inference.cerebras.ai/"};

    // === INITIALIZATION ===
    window.onload = function() {
        fetchData();
        // Close modal on outside click
        document.getElementById('modal').addEventListener('click', (e) => {
            if(e.target === document.getElementById('modal')) closeModal();
        });
    };

    async function fetchData() {
        try {
            const res = await fetch("data.json?t=" + Date.now());
            if(!res.ok) throw new Error("Failed to load");
            appData = await res.json();
            
            document.getElementById('node-count').textContent = appData.results ? appData.results.length : 0;
            render();
            renderChart();
        } catch (e) {
            console.error(e);
        }
    }

    // === RENDERING ===
    function render() {
        if(!appData || !appData.results) return;
        
        // SORTING LOGIC
        const sorted = [...appData.results].sort((a,b) => {
            if(a.status !== 'Online') return 1; if(b.status !== 'Online') return -1;
            
            if(currentSort === 'score') return b.braiain_score - a.braiain_score;
            if(currentSort === 'speed') return a.time - b.time; 
            if(currentSort === 'tps') return b.tokens_per_second - a.tokens_per_second;
            if(currentSort === 'ttft') return (a.ttft||99) - (b.ttft||99);
            if(currentSort === 'cost') return a.cost_per_request - b.cost_per_request;
            return 0;
        });

        // 1. RENDER GRID
        const gridHtml = sorted.map((r, i) => {
            const comps = parseGrade(r.grade_breakdown);
            const cleanText = cleanTextSnippet(r.full_response);
            
            return `
            <div class="bz-card">
                <div class="bz-card-header">
                    <div>
                        <div class="bz-provider">${r.provider}</div>
                        <span class="bz-model">${r.model}</span>
                    </div>
                    <div class="bz-rank">#${i+1}</div>
                </div>
                
                <div class="bz-stats">
                    <div class="bz-stat-item">
                        <span class="bz-stat-label">SCORE</span>
                        <span class="bz-stat-val val-good">${r.braiain_score}</span>
                    </div>
                    <div class="bz-stat-item">
                        <span class="bz-stat-label">SPEED</span>
                        <span class="bz-stat-val">${r.time.toFixed(2)}s</span>
                    </div>
                    <div class="bz-stat-item">
                        <span class="bz-stat-label">TPS</span>
                        <span class="bz-stat-val">${Math.round(r.tokens_per_second)}</span>
                    </div>
                    <div class="bz-stat-item">
                        <span class="bz-stat-label">COST</span>
                        <span class="bz-stat-val">${r.cost_per_request ? '$'+r.cost_per_request.toFixed(4) : 'FREE'}</span>
                    </div>
                </div>
                
                <div class="bz-checks">
                    <div class="bz-check-item"><span class="bz-check-lbl">JSON</span><span class="${comps.json?'icon-ok':'icon-bad'}">●</span></div>
                    <div class="bz-check-item"><span class="bz-check-lbl">LOGIC</span><span class="${comps.logic?'icon-ok':'icon-bad'}">●</span></div>
                    <div class="bz-check-item"><span class="bz-check-lbl">CODE</span><span class="${comps.code?'icon-ok':'icon-bad'}">●</span></div>
                </div>
                
                <div class="bz-preview" onclick="openModal('${r.provider}', '${escapeText(r.full_response)}')">
                    <div class="bz-preview-text">${cleanText}</div>
                </div>
                
                <div class="bz-actions">
                    <button class="bz-btn btn-outline" onclick="openModal('${r.provider}', '${escapeText(r.full_response)}')">VIEW OUTPUT</button>
                    <a href="${AFFILIATES[r.provider] || '#'}" target="_blank" class="bz-btn btn-fill">VISIT</a>
                </div>
            </div>`;
        }).join('');
        document.getElementById('grid-container').innerHTML = gridHtml;

        // 2. RENDER LIST
        const listHtml = sorted.map((r, i) => {
            const comps = parseGrade(r.grade_breakdown);
            const cleanText = cleanTextSnippet(r.full_response);
            
            return `
            <tr>
                <td class="col-center"><strong>${i+1}</strong></td>
                <td><strong>${r.provider}</strong></td>
                <td style="color:#777; font-size:0.8rem;">${r.model}</td>
                <td class="col-center"><strong style="color:#fff;">${r.braiain_score}</strong></td>
                <td class="col-center">${r.time.toFixed(2)}s</td>
                <td class="col-center">${Math.round(r.tokens_per_second)}</td>
                <td class="col-center">${r.ttft ? r.ttft.toFixed(3) : '-'}</td>
                <td class="col-center">${r.cost_per_request ? '$'+r.cost_per_request.toFixed(4) : 'FREE'}</td>
                
                <td class="col-center col-check"><span class="${comps.json?'icon-ok':'icon-bad'}">●</span></td>
                <td class="col-center col-check"><span class="${comps.logic?'icon-ok':'icon-bad'}">●</span></td>
                <td class="col-center col-check"><span class="${comps.code?'icon-ok':'icon-bad'}">●</span></td>
                
                <td>
                    <div class="table-preview" onclick="openModal('${r.provider}', '${escapeText(r.full_response)}')" title="Click for full response">
                        ${cleanText}
                    </div>
                </td>
                
                <td class="col-center"><a href="${AFFILIATES[r.provider] || '#'}" target="_blank" class="table-visit-btn">GO</a></td>
            </tr>`;
        }).join('');
        document.getElementById('table-body').innerHTML = listHtml;
    }

    // === HELPERS ===
    function setMode(mode) {
        document.getElementById('grid-container').classList.toggle('hidden', mode !== 'grid');
        document.getElementById('list-container').classList.toggle('hidden', mode !== 'list');
        document.getElementById('btn-grid').classList.toggle('active', mode === 'grid');
        document.getElementById('btn-list').classList.toggle('active', mode === 'list');
    }

    function setSort(type) {
        currentSort = type;
        document.querySelectorAll('.btn-group button').forEach(b => b.classList.remove('active'));
        document.getElementById('sort-'+type).classList.add('active');
        render();
    }

    function parseGrade(notes) {
        const s = (notes || "").toLowerCase();
        return {
            json: s.includes("json perfect") || s.includes("json ok"),
            logic: s.includes("logic correct"),
            code: s.includes("code perfect")
        };
    }

    // STRIPS PROMPT TEXT ("PART 1 - JSON...") from preview
    function cleanTextSnippet(text) {
        if(!text) return "";
        let clean = text;
        clean = clean.replace(/PART \d+ - [A-Z ]+:/gi, "");
        clean = clean.replace(/```[a-z]*\n?/gi, "");
        return clean.trim().substring(0, 300);
    }

    function escapeText(str) {
        return (str || "").replace(/'/g, "\\'").replace(/"/g, '&quot;').replace(/\n/g, '\\n');
    }

    // === MODAL ===
    function openModal(title, text) {
        document.getElementById('modal-title').textContent = title;
        document.getElementById('modal-text').textContent = text;
        document.getElementById('modal').style.display = 'block';
    }
    function closeModal() {
        document.getElementById('modal').style.display = 'none';
    }

    // === CHART ===
    function renderChart() {
        if(!appData.history) return;
        const ctx = document.getElementById('mainChart');
        const history = appData.history;
        
        // Extract providers
        const providers = new Set();
        history.forEach(h => { if(h.results) Object.keys(h.results).forEach(k => providers.add(k)); });
        
        const colors = ['#00ff41', '#00f3ff', '#ff0055', '#ffaa00', '#aa00ff', '#ffffff', '#ffff00'];
        const datasets = Array.from(providers).map((p, i) => ({
            label: p,
            borderColor: colors[i % colors.length],
            borderWidth: 2,
            pointRadius: 3,
            tension: 0.4,
            data: history.map(h => {
                const res = h.results ? h.results[p] : null;
                return (res && res.status === 'Online') ? res.time : null;
            })
        }));

        if(chartInstance) chartInstance.destroy();
        chartInstance = new Chart(ctx, {
            type: 'line',
            data: { 
                labels: history.map(h => new Date(h.timestamp.replace(' UTC','Z')).toLocaleDateString()),
                datasets: datasets 
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: { mode: 'index', intersect: false },
                scales: {
                    y: { grid: { color: 'rgba(255,255,255,0.05)' }, title: { display: true, text: 'Speed (Seconds)' } },
                    x: { grid: { display: false } }
                },
                plugins: { legend: { labels: { color: '#888', font: { family:'Share Tech Mono' } } } }
            }
        });
    }
    
    function exportCSV() {
        if (!appData.results) return;
        let csv = 'Rank,Provider,Score,Speed,TTFT,TPS,Cost\n';
        const sorted = [...appData.results].sort((a,b) => b.braiain_score - a.braiain_score);
        sorted.forEach((r,i) => csv += `${i+1},"${r.provider}","${r.model}",${r.braiain_score},${r.time},${r.ttft},${r.tokens_per_second},${r.cost_per_request}\n`);
        const a = document.createElement('a');
        a.href = URL.createObjectURL(new Blob([csv], {type: 'text/csv'}));
        a.download = 'braiain_data.csv';
        document.body.appendChild(a); a.click(); document.body.removeChild(a);
    }
</script>
</body>
</html>
