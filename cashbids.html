<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0a0a0c">
    <title>Wisconsin & Minnesota Cash Grain Bids ‚Äî Find Local Elevators | AGSIST</title>
    <meta name="keywords" content="cash grain bids, local grain prices, elevator bids, corn cash bids, soybean cash bids, basis, Wisconsin grain elevators, Minnesota grain elevators, grain marketing, cash bids near me">
    <meta name="description" content="Live cash grain bids from Wisconsin & Minnesota elevators. Auto-detects your location, shows the nearest grain buyers with real prices, basis data, and distance. Updated every 2 hours during market hours.">
    <link rel="canonical" href="https://agsist.com/cashbids.html">
    <meta property="og:title" content="Cash Grain Bids ‚Äî Find Local Elevators | AGSIST">
    <meta property="og:description" content="WI & MN elevator cash bids updated every 2 hours. Auto-locate, compare prices, find the best basis. Free.">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Cash Grain Bids ‚Äî Find Local Elevators | AGSIST">
    <meta name="twitter:description" content="WI & MN elevator cash bids updated every 2 hours. Auto-locate, compare prices. Free.">
    <meta property="og:url" content="https://agsist.com/cashbids.html">
    <meta property="og:type" content="website">
    <link rel="icon" href="/favicon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/components/shared.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-6KXCTD5Z9H"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-6KXCTD5Z9H');</script>

    <style>
        :root {
            --bg: #0a0a0c; --surface: #111114; --card: #16161a; --card-hover: #1c1c22;
            --border: #2a2a32; --text: #e8e8ec; --dim: #8a8a94; --accent: #e6b042;
            --green: #22c55e; --red: #ef4444; --blue: #3b82f6; --cyan: #06b6d4;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'JetBrains Mono', monospace; background: var(--bg); color: var(--text); line-height: 1.7; }

        main { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .breadcrumb { font-size: 0.8rem; color: var(--dim); margin-bottom: 16px; }
        .breadcrumb a { color: var(--accent); text-decoration: none; }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HERO SEARCH ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .hero {
            background: linear-gradient(135deg, var(--card) 0%, #1a1a0a 50%, var(--card) 100%);
            border: 2px solid var(--accent);
            border-radius: 12px;
            padding: 32px 24px;
            text-align: center;
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
        }
        .hero::before {
            content: '';
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: radial-gradient(ellipse at 30% 50%, rgba(230,176,66,0.06) 0%, transparent 60%);
            pointer-events: none;
        }
        .hero h1 { font-size: 1.6rem; color: var(--accent); margin-bottom: 4px; position: relative; }
        .hero .subtitle { color: var(--dim); font-size: 0.85rem; margin-bottom: 20px; position: relative; }
        .hero .stat-bar {
            display: flex; justify-content: center; gap: 24px; flex-wrap: wrap;
            margin-bottom: 20px; position: relative;
        }
        .hero .stat { font-size: 0.75rem; color: var(--dim); }
        .hero .stat strong { color: var(--accent); font-size: 1.1rem; display: block; }

        .search-row {
            display: flex; gap: 10px; max-width: 600px; margin: 0 auto 12px;
            position: relative; flex-wrap: wrap;
        }
        .search-row input {
            flex: 1; min-width: 180px; padding: 14px 16px; font-size: 1rem;
            font-family: inherit; background: var(--bg); border: 1px solid var(--border);
            border-radius: 6px; color: var(--text); text-align: center;
        }
        .search-row input:focus { outline: none; border-color: var(--accent); }
        .search-row input::placeholder { color: var(--dim); }

        .btn-primary {
            padding: 14px 24px; font-size: 0.9rem; font-family: inherit; font-weight: 600;
            background: var(--accent); color: #000; border: none; border-radius: 6px;
            cursor: pointer; transition: all 0.2s; white-space: nowrap;
        }
        .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(230,176,66,0.3); }

        .btn-geo {
            padding: 14px 16px; font-size: 0.9rem; font-family: inherit; font-weight: 500;
            background: var(--card); color: var(--accent); border: 1px solid var(--accent);
            border-radius: 6px; cursor: pointer; transition: all 0.2s; white-space: nowrap;
        }
        .btn-geo:hover { background: rgba(230,176,66,0.1); }

        .quick-zips {
            display: flex; flex-wrap: wrap; gap: 8px; justify-content: center;
            margin-top: 16px; position: relative;
        }
        .quick-zip {
            padding: 6px 12px; font-size: 0.7rem; font-family: inherit;
            background: var(--bg); border: 1px solid var(--border); border-radius: 4px;
            color: var(--dim); cursor: pointer; transition: all 0.15s;
        }
        .quick-zip:hover { border-color: var(--accent); color: var(--accent); }

        .powered { font-size: 0.65rem; color: var(--dim); margin-top: 12px; position: relative; }
        .powered a { color: var(--accent); text-decoration: none; }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FILTERS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .filter-bar {
            display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 20px;
            align-items: center;
        }
        .filter-bar label { font-size: 0.75rem; color: var(--dim); font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }
        .filter-btn {
            padding: 6px 14px; font-size: 0.75rem; font-family: inherit;
            background: var(--card); border: 1px solid var(--border); border-radius: 4px;
            color: var(--dim); cursor: pointer; transition: all 0.15s;
        }
        .filter-btn:hover { border-color: var(--accent); color: var(--text); }
        .filter-btn.active { background: var(--accent); color: #000; border-color: var(--accent); font-weight: 600; }

        .radius-select {
            padding: 6px 10px; font-family: inherit; font-size: 0.75rem;
            background: var(--card); border: 1px solid var(--border); border-radius: 4px;
            color: var(--text); cursor: pointer;
        }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê RESULTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        #results-status {
            font-size: 0.8rem; color: var(--dim); margin-bottom: 16px;
            padding: 10px 16px; background: var(--card); border-radius: 6px;
            border-left: 3px solid var(--accent); display: none;
        }
        #results-status .loc-name { color: var(--accent); font-weight: 600; }

        .elevator-grid { display: grid; grid-template-columns: 1fr; gap: 12px; margin-bottom: 24px; }

        .elev-card {
            background: var(--card); border: 1px solid var(--border); border-radius: 8px;
            padding: 16px 20px; transition: all 0.2s; position: relative;
            display: grid; grid-template-columns: 1fr auto; gap: 12px; align-items: start;
        }
        .elev-card:hover { border-color: var(--accent); background: var(--card-hover); }

        .elev-info { min-width: 0; }
        .elev-name { font-size: 0.95rem; font-weight: 700; color: var(--text); margin-bottom: 2px; }
        .elev-loc { font-size: 0.75rem; color: var(--dim); margin-bottom: 6px; }
        .elev-loc .dist { color: var(--accent); font-weight: 600; }

        .elev-tags { display: flex; flex-wrap: wrap; gap: 4px; margin-bottom: 8px; }
        .elev-tag {
            font-size: 0.6rem; padding: 2px 8px; border-radius: 3px;
            font-weight: 600; text-transform: uppercase; letter-spacing: 0.03em;
        }
        .elev-tag.corn { background: rgba(230,176,66,0.15); color: var(--accent); }
        .elev-tag.soy { background: rgba(34,197,94,0.15); color: var(--green); }
        .elev-tag.wheat { background: rgba(59,130,246,0.15); color: var(--blue); }
        .elev-tag.oats { background: rgba(6,182,212,0.15); color: var(--cyan); }
        .elev-tag.ethanol { background: rgba(139,92,246,0.15); color: #8b5cf6; }
        .elev-tag.processor { background: rgba(239,68,68,0.15); color: var(--red); }

        .elev-actions { display: flex; flex-direction: column; gap: 6px; align-items: flex-end; }
        .bid-link {
            display: inline-block; padding: 8px 14px; font-size: 0.7rem; font-family: inherit;
            font-weight: 600; background: var(--accent); color: #000; border-radius: 4px;
            text-decoration: none; transition: all 0.15s; text-align: center; white-space: nowrap;
        }
        .bid-link:hover { transform: translateY(-1px); box-shadow: 0 2px 8px rgba(230,176,66,0.3); }
        .bid-link.secondary {
            background: transparent; color: var(--accent); border: 1px solid var(--accent);
        }
        .bid-link.secondary:hover { background: rgba(230,176,66,0.1); }

        .elev-phone { font-size: 0.7rem; color: var(--dim); text-align: right; }
        .elev-phone a { color: var(--dim); text-decoration: none; }
        .elev-phone a:hover { color: var(--accent); }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PANELS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .panel { background: var(--card); border: 1px solid var(--border); border-radius: 8px; overflow: hidden; margin-bottom: 20px; }
        .panel-head { padding: 14px 20px; border-bottom: 1px solid var(--border); }
        .panel-head h2 { font-size: 1rem; color: var(--accent); margin: 0; }
        .panel-body { padding: 20px; }

        .basis-formula {
            font-size: 1rem; color: var(--accent); text-align: center; padding: 14px;
            background: var(--bg); border: 1px solid var(--border); border-radius: 6px; margin: 12px 0;
        }
        .tips-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px; }
        .tip-card { background: var(--bg); border: 1px solid var(--border); border-radius: 6px; padding: 14px; }
        .tip-card h4 { color: var(--accent); font-size: 0.8rem; margin-bottom: 6px; }
        .tip-card p { color: var(--dim); font-size: 0.78rem; line-height: 1.5; }

        .usda-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 12px; }
        .usda-card {
            display: block; background: var(--bg); border: 1px solid var(--border); border-radius: 6px;
            padding: 14px; text-decoration: none; transition: all 0.15s;
        }
        .usda-card:hover { border-color: var(--accent); }
        .usda-card strong { color: var(--text); font-size: 0.85rem; display: block; margin-bottom: 4px; }
        .usda-card span { color: var(--dim); font-size: 0.72rem; }

        .resource-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 10px; }
        .resource-link {
            display: block; padding: 14px; background: var(--bg); border: 1px solid var(--border);
            border-radius: 6px; text-decoration: none; transition: all 0.15s;
        }
        .resource-link:hover { border-color: var(--accent); }
        .resource-link strong { color: var(--text); font-size: 0.8rem; display: block; }
        .resource-link span { color: var(--dim); font-size: 0.7rem; }

        .no-results {
            text-align: center; padding: 40px 20px; color: var(--dim);
        }
        .no-results h3 { color: var(--accent); margin-bottom: 8px; font-size: 1rem; }
        .no-results p { font-size: 0.85rem; }

        .loading { text-align: center; padding: 20px; color: var(--dim); font-size: 0.85rem; }
        .spinner {
            display: inline-block; width: 20px; height: 20px;
            border: 2px solid var(--border); border-top-color: var(--accent);
            border-radius: 50%; animation: spin 0.8s linear infinite;
            vertical-align: middle; margin-right: 8px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        .count-badge {
            display: inline-block; padding: 2px 8px; font-size: 0.65rem;
            background: rgba(230,176,66,0.15); color: var(--accent); border-radius: 3px;
            font-weight: 600; margin-left: 8px; vertical-align: middle;
        }

        /* Bid Badges */
        .bid-row { display: flex; gap: 6px; flex-wrap: wrap; margin-top: 6px; }
        .bid-badge {
            font-size: 0.72rem; padding: 3px 8px; border-radius: 4px;
            background: rgba(230,176,66,0.1); border: 1px solid rgba(230,176,66,0.25);
            color: #e6b042; font-weight: 600; white-space: nowrap;
        }
        .bid-badge small { font-weight: 400; color: var(--dim); }
        .bid-badge.corn { border-color: rgba(255,193,7,0.3); background: rgba(255,193,7,0.08); }
        .bid-badge.soy { border-color: rgba(76,175,80,0.3); background: rgba(76,175,80,0.08); color: #81c784; }
        .bid-badge.soy small { color: var(--dim); }
        .bid-badge.wheat { border-color: rgba(255,152,0,0.3); background: rgba(255,152,0,0.08); color: #ffb74d; }
        .bid-badge.wheat small { color: var(--dim); }
        .bid-badge.oats { border-color: rgba(6,182,212,0.3); background: rgba(6,182,212,0.08); color: #67e8f9; }
        .bid-badge.oats small { color: var(--dim); }
        #bids-updated {
            display: none; font-size: 0.7rem; color: var(--accent); margin-left: 12px;
            background: rgba(230,176,66,0.1); padding: 2px 8px; border-radius: 4px;
        }

        /* View Toggle */
        .view-toggle {
            display: flex; gap: 4px; margin-bottom: 16px;
            background: var(--card); border: 1px solid var(--border); border-radius: 8px; padding: 4px; width: fit-content;
        }
        .view-btn {
            background: transparent; border: none; color: var(--dim); font-family: var(--font);
            font-size: 0.85rem; padding: 8px 16px; border-radius: 6px; cursor: pointer; transition: all 0.2s;
        }
        .view-btn.active { background: var(--accent); color: #000; font-weight: 600; }
        .view-btn:hover:not(.active) { color: var(--text); background: rgba(230,176,66,0.1); }

        /* Map */
        #elevator-map {
            width: 100%; height: 550px; border-radius: 8px; border: 1px solid var(--border);
            background: #1a1a2e;
        }
        #map-container { margin-bottom: 16px; }
        .map-legend {
            display: flex; gap: 16px; flex-wrap: wrap; padding: 10px 0; font-size: 0.8rem; color: var(--dim);
        }
        .legend-item { display: flex; align-items: center; gap: 5px; }
        .legend-dot { width: 12px; height: 12px; border-radius: 50%; display: inline-block; }
        .leaflet-popup-content-wrapper {
            background: #1a1a2e !important; color: #e0e0e0 !important; border: 1px solid #333 !important;
            border-radius: 8px !important; font-family: 'JetBrains Mono', monospace !important;
        }
        .leaflet-popup-tip { background: #1a1a2e !important; }
        .leaflet-popup-content { font-size: 0.82rem !important; line-height: 1.5 !important; }
        .leaflet-popup-content a { color: #e6b042 !important; }
        .leaflet-popup-content strong { color: #fff; }

        /* Responsive */
        @media (max-width: 768px) {
            main { padding: 12px; }
            .hero { padding: 20px 16px; }
            .hero h1 { font-size: 1.2rem; }
            .search-row { flex-direction: column; }
            .search-row input, .btn-primary, .btn-geo { width: 100%; }
            .elev-card { grid-template-columns: 1fr; }
            .elev-actions { flex-direction: row; flex-wrap: wrap; align-items: flex-start; }
            .hero .stat-bar { gap: 16px; }
            #elevator-map { height: 400px; }
        }
        @media (min-width: 769px) {
            .elevator-grid { grid-template-columns: 1fr; }
        }
    </style>

    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Cash Grain Bids & Elevator Finder",
        "description": "Live cash grain bids from Wisconsin and Minnesota elevators. Geolocation-based proximity search with real prices updated every 2 hours.",
        "url": "https://agsist.com/cashbids.html",
        "applicationCategory": "Agriculture",
        "operatingSystem": "Web Browser",
        "offers": {"@type": "Offer", "price": "0", "priceCurrency": "USD"}
    }
    </script>
</head>
<body>
    <div id="header"></div>

    <main id="main-content">
        <nav class="breadcrumb"><a href="/">Home</a> ‚Üí <a href="/tools.html">Tools</a> ‚Üí Cash Bids</nav>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HERO SEARCH ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div class="hero">
            <h1>üåæ Cash Grain Bids ‚Äî Elevator Finder</h1>
            <p class="subtitle">Live prices from WI & MN elevators ‚Äî updated every 2 hours</p>
            <div class="stat-bar">
                <div class="stat"><strong id="totalCount">‚Äî</strong>Elevators</div>
                <div class="stat"><strong>WI + MN</strong>Coverage</div>
                <span id="bids-updated"></span>
                <div class="stat"><strong>Free</strong>Always</div>
            </div>

            <div class="search-row">
                <input type="text" id="zipInput" placeholder="Enter ZIP code" maxlength="5" pattern="[0-9]{5}" inputmode="numeric" autocomplete="postal-code">
                <button class="btn-primary" onclick="searchByZip()">Search ‚Üí</button>
                <button class="btn-geo" onclick="useMyLocation()">üìç Use My Location</button>
            </div>
            <div id="geoStatus" style="font-size:0.72rem; color:var(--dim); margin-top:6px;"></div>

            <div class="quick-zips">
                <button class="quick-zip" onclick="quickZip('54812')">Barron</button>
                <button class="quick-zip" onclick="quickZip('54701')">Eau Claire</button>
                <button class="quick-zip" onclick="quickZip('54751')">Menomonie</button>
                <button class="quick-zip" onclick="quickZip('53916')">Beaver Dam</button>
                <button class="quick-zip" onclick="quickZip('53954')">Portage</button>
                <button class="quick-zip" onclick="quickZip('54401')">Wausau</button>
                <button class="quick-zip" onclick="quickZip('53703')">Madison</button>
                <button class="quick-zip" onclick="quickZip('54880')">Superior</button>
                <button class="quick-zip" onclick="quickZip('54220')">Manitowoc</button>
                <button class="quick-zip" onclick="quickZip('54956')">Neenah</button>
                <button class="quick-zip" onclick="quickZip('56001')">Mankato MN</button>
                <button class="quick-zip" onclick="quickZip('55060')">Owatonna MN</button>
                <button class="quick-zip" onclick="quickZip('55901')">Rochester MN</button>
                <button class="quick-zip" onclick="quickZip('55987')">Winona MN</button>
                <button class="quick-zip" onclick="quickZip('56003')">St. Peter MN</button>
                <button class="quick-zip" onclick="quickZip('56073')">New Ulm MN</button>
            </div>

            <p class="powered">Data: <a href="https://farmbucks.com" target="_blank">Farmbucks</a> + <a href="https://www.barchart.com/cmdty" target="_blank">Barchart</a> ¬∑ Scraped every 2 hrs during market hours ¬∑ <a href="https://github.com/agsist/agsist.com" target="_blank">Open source</a></p>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FILTERS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div class="filter-bar">
            <label>Filter:</label>
            <button class="filter-btn active" data-filter="all" onclick="setFilter('all',this)">All</button>
            <button class="filter-btn" data-filter="corn" onclick="setFilter('corn',this)">üåΩ Corn</button>
            <button class="filter-btn" data-filter="soy" onclick="setFilter('soy',this)">ü´ò Soybeans</button>
            <button class="filter-btn" data-filter="wheat" onclick="setFilter('wheat',this)">üåæ Wheat</button>
            <button class="filter-btn" data-filter="oats" onclick="setFilter('oats',this)">Oats</button>
            <label style="margin-left:auto;">Radius:</label>
            <select class="radius-select" id="radiusSelect" onchange="rerender()">
                <option value="25">25 mi</option>
                <option value="50" selected>50 mi</option>
                <option value="75">75 mi</option>
                <option value="100">100 mi</option>
                <option value="999">All</option>
            </select>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê VIEW TOGGLE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div class="view-toggle">
            <button class="view-btn active" id="btnListView" onclick="switchView('list')">üìã List View</button>
            <button class="view-btn" id="btnMapView" onclick="switchView('map')">üó∫Ô∏è Map View</button>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MAP ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div id="map-container" style="display:none;">
            <div id="elevator-map"></div>
            <div class="map-legend">
                <span class="legend-item"><span class="legend-dot" style="background:#4CAF50"></span>Co-op</span>
                <span class="legend-item"><span class="legend-dot" style="background:#2196F3"></span>Elevator</span>
                <span class="legend-item"><span class="legend-dot" style="background:#FF9800"></span>Ethanol</span>
                <span class="legend-item"><span class="legend-dot" style="background:#9C27B0"></span>Processor</span>
                <span class="legend-item"><span class="legend-dot" style="background:#e6b042"></span>You</span>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê RESULTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div id="results-status"></div>
        <div id="elevator-list" class="elevator-grid">
            <div class="loading"><span class="spinner"></span> Loading elevator data...</div>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê USDA REPORTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div class="panel">
            <div class="panel-head"><h2>üìä USDA Daily Grain Reports (Free Government Data)</h2></div>
            <div class="panel-body">
                <p style="color:var(--dim);font-size:0.8rem;margin-bottom:14px;">Official USDA AMS regional cash bids updated daily. Public domain ‚Äî no paywall, no API key.</p>
                <div class="usda-grid">
                    <a href="https://www.ams.usda.gov/mnreports/AMS_3049.pdf" target="_blank" rel="noopener" class="usda-card">
                        <strong>üìÑ Southern Minnesota Daily Grain Bids</strong>
                        <span>Corn, soybeans, wheat ‚Äî basis & cash prices by region. Closest USDA report to WI.</span>
                    </a>
                    <a href="https://www.ams.usda.gov/mnreports/AMS_2850.pdf" target="_blank" rel="noopener" class="usda-card">
                        <strong>üìÑ Iowa Daily Cash Grain Bids</strong>
                        <span>Terminal, country elevator & processor bids. State averages & basis.</span>
                    </a>
                    <a href="https://www.ams.usda.gov/mnreports/AMS_3192.pdf" target="_blank" rel="noopener" class="usda-card">
                        <strong>üìÑ Illinois Daily Grain Bids</strong>
                        <span>Major terminal market & river elevator bids. Key CBOT delivery market.</span>
                    </a>
                    <a href="https://www.ams.usda.gov/mnreports/AMS_3043.pdf" target="_blank" rel="noopener" class="usda-card">
                        <strong>üìÑ Iowa‚ÄìS. Minnesota Barge Terminal Bids</strong>
                        <span>Mississippi River barge loading basis. Export channel prices.</span>
                    </a>
                    <a href="https://www.ams.usda.gov/market-news/state-grain-reports" target="_blank" rel="noopener" class="usda-card">
                        <strong>üìÑ All State Grain Reports Index</strong>
                        <span>USDA AMS daily reports for every state. Bookmark this.</span>
                    </a>
                    <a href="https://mymarketnews.ams.usda.gov/public_data" target="_blank" rel="noopener" class="usda-card">
                        <strong>üìÑ MyMarketNews Public Data</strong>
                        <span>Full USDA market news database. Grain, livestock, dairy, specialty crops.</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê BASIS EDUCATION ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div class="panel">
            <div class="panel-head"><h2>üìà Understanding Cash Bids & Basis</h2></div>
            <div class="panel-body">
                <p style="color:var(--text);font-size:0.85rem;margin-bottom:8px;"><strong>Cash Bid</strong> = the price a local elevator pays you for grain today.</p>
                <p style="color:var(--text);font-size:0.85rem;margin-bottom:8px;"><strong>Basis</strong> = difference between local cash price and CBOT futures.</p>
                <div class="basis-formula">Cash Price = Futures Price + Basis</div>
                <p style="color:var(--dim);font-size:0.78rem;margin-bottom:16px;">Example: March corn futures at $4.50 + local basis of ‚àí$0.35 = <strong style="color:var(--accent)">$4.15/bu</strong> cash bid</p>

                <div class="tips-grid">
                    <div class="tip-card">
                        <h4>üìà Narrow Basis = Better Price</h4>
                        <p>‚àí$0.20 beats ‚àí$0.40. Watch for basis to narrow (move toward zero) before selling.</p>
                    </div>
                    <div class="tip-card">
                        <h4>üìÖ Seasonal Patterns</h4>
                        <p>Basis widens at harvest (more supply) and narrows in spring/summer. Historical patterns help predict moves.</p>
                    </div>
                    <div class="tip-card">
                        <h4>üöö Location Matters</h4>
                        <p>Elevators near ethanol plants, river terminals, or processors often have stronger basis than remote country elevators.</p>
                    </div>
                    <div class="tip-card">
                        <h4>üí∞ Compare Multiple Buyers</h4>
                        <p>10¬¢ better basis on 10,000 bu = $1,000 more income. This tool shows every buyer within your radius.</p>
                    </div>
                    <div class="tip-card">
                        <h4>üìù Basis Contracts</h4>
                        <p>Lock in a strong basis now, set futures price later. Useful when basis is unusually narrow but you think futures will rally.</p>
                    </div>
                    <div class="tip-card">
                        <h4>üè≠ Processor Premium</h4>
                        <p>Ethanol plants and soy crushers often pay stronger basis than country elevators because they need constant supply.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê RESOURCES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div class="panel">
            <div class="panel-head"><h2>üîó More Cash Bid Resources</h2></div>
            <div class="panel-body">
                <div class="resource-grid">
                    <a href="https://www.agweb.com/markets/cash-grain-bids" target="_blank" rel="noopener" class="resource-link">
                        <strong>AgWeb Cash Bids</strong><span>Search any US zip code ‚Äî Barchart-powered</span>
                    </a>
                    <a href="https://www.dtnpf.com/agriculture/web/ag/markets/local-grain-bids" target="_blank" rel="noopener" class="resource-link">
                        <strong>DTN Local Grain Bids</strong><span>Map-based national search tool</span>
                    </a>
                    <a href="https://farmbucks.com" target="_blank" rel="noopener" class="resource-link">
                        <strong>Farmbucks</strong><span>Compare bids across buyers ‚Äî free tier</span>
                    </a>
                    <a href="https://farmdoc.illinois.edu/fast-tools/corn-soybean-basis-tool" target="_blank" rel="noopener" class="resource-link">
                        <strong>Farmdoc Basis Tool</strong><span>Historical basis analysis by crop district</span>
                    </a>
                    <a href="/breakeven.html" class="resource-link">
                        <strong>Break-Even Calculator</strong><span>Know your cost before you sell</span>
                    </a>
                    <a href="/corn-prices.html" class="resource-link">
                        <strong>Live Futures Prices</strong><span>Corn, soybeans, wheat ‚Äî real-time</span>
                    </a>
                    <a href="https://www.cargillag.com/check-prices" target="_blank" rel="noopener" class="resource-link">
                        <strong>Cargill Grain Prices</strong><span>Cargill elevator bids by location</span>
                    </a>
                    <a href="https://www.uwgp.com/cash-bids" target="_blank" rel="noopener" class="resource-link">
                        <strong>United WI Grain Producers</strong><span>Specialty grain cash bids</span>
                    </a>
                </div>
            </div>
        </div>
    </main>

    <div id="footer"></div>
    <script src="/components/load-components.js"></script>

    <script>
    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       AGSIST CASH BIDS ‚Äî Data-driven from bids.json
       No hardcoded elevator list. bids.json IS the database.
       Generated by scrape_bids.py (Farmbucks + Barchart hybrid)
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ZIP CODE LOOKUP (local, no API needed) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    const ZIP_DB = {
        "53703":{"lat":43.0731,"lng":-89.4012,"city":"Madison"},"53711":{"lat":43.0435,"lng":-89.4400,"city":"Madison"},
        "53916":{"lat":43.4578,"lng":-88.8373,"city":"Beaver Dam"},"53954":{"lat":43.5389,"lng":-89.4626,"city":"Portage"},
        "54301":{"lat":44.5133,"lng":-88.0158,"city":"Green Bay"},"54401":{"lat":44.9591,"lng":-89.6301,"city":"Wausau"},
        "54481":{"lat":44.5236,"lng":-89.5746,"city":"Stevens Point"},"54601":{"lat":43.8014,"lng":-91.2396,"city":"La Crosse"},
        "54701":{"lat":44.8113,"lng":-91.4985,"city":"Eau Claire"},"54751":{"lat":44.8753,"lng":-91.9193,"city":"Menomonie"},
        "54812":{"lat":45.4014,"lng":-91.8440,"city":"Barron"},"54880":{"lat":46.7208,"lng":-92.1041,"city":"Superior"},
        "53081":{"lat":43.7508,"lng":-87.7145,"city":"Sheboygan"},"54220":{"lat":44.0886,"lng":-87.6576,"city":"Manitowoc"},
        "54956":{"lat":44.1858,"lng":-88.4612,"city":"Neenah"},"53151":{"lat":42.9289,"lng":-88.0583,"city":"New Berlin"},
        "53202":{"lat":43.0389,"lng":-87.9065,"city":"Milwaukee"},"54901":{"lat":44.0247,"lng":-88.5426,"city":"Oshkosh"},
        "53511":{"lat":42.5083,"lng":-89.0318,"city":"Beloit"},"53545":{"lat":42.6828,"lng":-89.0187,"city":"Janesville"},
        "53566":{"lat":42.6012,"lng":-89.6384,"city":"Monroe"},"53818":{"lat":42.7343,"lng":-90.4784,"city":"Platteville"},
        "53801":{"lat":42.7817,"lng":-91.1229,"city":"Boscobel"},"54615":{"lat":44.1133,"lng":-90.8129,"city":"Black River Falls"},
        "54660":{"lat":43.9836,"lng":-90.5040,"city":"Tomah"},"54403":{"lat":44.9591,"lng":-89.6301,"city":"Wausau"},
        "54474":{"lat":44.8011,"lng":-90.0782,"city":"Stratford"},"54494":{"lat":44.3836,"lng":-89.8173,"city":"Wis Rapids"},
        "54449":{"lat":44.6305,"lng":-90.1774,"city":"Marshfield"},"54952":{"lat":44.2619,"lng":-88.4451,"city":"Menasha"},
        "53001":{"lat":43.6508,"lng":-87.9912,"city":"Adell"},"53010":{"lat":43.6117,"lng":-88.3451,"city":"Campbellsport"},
        "53019":{"lat":43.7453,"lng":-88.1183,"city":"Eden"},"53013":{"lat":43.5281,"lng":-87.9012,"city":"Cedar Grove"},
        "53042":{"lat":43.9122,"lng":-88.0361,"city":"Kiel"},"53014":{"lat":44.0289,"lng":-88.1629,"city":"Chilton"},
        "54230":{"lat":44.1536,"lng":-87.9567,"city":"Reedsville"},"54245":{"lat":44.0672,"lng":-87.8883,"city":"Valders"},
        "53075":{"lat":43.5508,"lng":-87.9617,"city":"Random Lake"},
        "54729":{"lat":45.1003,"lng":-91.4882,"city":"Chippewa Falls"},"54724":{"lat":45.1003,"lng":-91.4882,"city":"Bloomer"},
        "54768":{"lat":44.9597,"lng":-90.9357,"city":"Stanley"},
        "54822":{"lat":45.4078,"lng":-91.7440,"city":"Cameron"},"54868":{"lat":45.5061,"lng":-91.7382,"city":"Rice Lake"},
        "54736":{"lat":44.6266,"lng":-91.9649,"city":"Durand"},"54738":{"lat":44.7611,"lng":-91.2781,"city":"Fall Creek"},
        "54722":{"lat":44.6800,"lng":-91.1200,"city":"Augusta"},
        "53932":{"lat":43.5439,"lng":-89.1064,"city":"Cambria"},"53919":{"lat":43.5858,"lng":-89.0667,"city":"Brandon"},
        "53950":{"lat":43.7975,"lng":-90.0773,"city":"Mauston"},"53910":{"lat":43.9561,"lng":-89.8120,"city":"Adams"},
        "54616":{"lat":44.2944,"lng":-91.2329,"city":"Blair"},"54669":{"lat":43.9000,"lng":-91.0862,"city":"West Salem"},
        "53582":{"lat":43.1647,"lng":-89.0090,"city":"Arena"},"53555":{"lat":43.3133,"lng":-89.5262,"city":"Lodi"},
        "53534":{"lat":42.7803,"lng":-89.2987,"city":"Evansville"},"53589":{"lat":42.9172,"lng":-89.2179,"city":"Stoughton"},
        "53561":{"lat":43.0760,"lng":-89.2012,"city":"Cottage Grove"},"53528":{"lat":43.0200,"lng":-89.7440,"city":"Cross Plains"},
        "54011":{"lat":44.9744,"lng":-92.3743,"city":"Baldwin"},
        "53520":{"lat":42.6832,"lng":-90.1185,"city":"Darlington"},
        "54612":{"lat":43.6522,"lng":-90.3431,"city":"Hillsboro"},"53959":{"lat":43.5325,"lng":-90.0026,"city":"Reedsburg"},
        "53968":{"lat":43.6517,"lng":-90.2282,"city":"Wonewoc"},
        "53168":{"lat":42.6839,"lng":-88.0512,"city":"Union Grove"},
        "53095":{"lat":43.4253,"lng":-88.1834,"city":"West Bend"},"53066":{"lat":43.2617,"lng":-88.2340,"city":"Oconomowoc"},
        "53105":{"lat":42.6781,"lng":-88.2762,"city":"Burlington"},
        "53901":{"lat":43.5458,"lng":-89.4626,"city":"Portage"},
        "56001":{"lat":44.1636,"lng":-94.0022,"city":"Mankato"},"55060":{"lat":44.0836,"lng":-93.2261,"city":"Owatonna"},
        "55021":{"lat":44.2919,"lng":-93.2908,"city":"Faribault"},"55066":{"lat":44.5633,"lng":-92.5338,"city":"Red Wing"},
        "55985":{"lat":43.8094,"lng":-91.7529,"city":"Rushford"},"55912":{"lat":43.6647,"lng":-92.9746,"city":"Austin"},
        "55720":{"lat":46.7208,"lng":-92.1041,"city":"Cloquet"},"55987":{"lat":44.0550,"lng":-91.6393,"city":"Winona"},
        "55910":{"lat":43.6344,"lng":-91.4968,"city":"Caledonia"},"55016":{"lat":44.7314,"lng":-92.8064,"city":"Cottage Grove MN"},
        "55901":{"lat":44.0231,"lng":-92.4699,"city":"Rochester"},"55044":{"lat":44.5069,"lng":-93.2707,"city":"Lakeville"},
        "55369":{"lat":45.1558,"lng":-93.6628,"city":"Osseo"},"55118":{"lat":44.9063,"lng":-93.1472,"city":"St Paul"},
        "56003":{"lat":44.3236,"lng":-93.9580,"city":"St. Peter"},"56073":{"lat":44.3125,"lng":-94.4608,"city":"New Ulm"},
        "56088":{"lat":43.8278,"lng":-94.4325,"city":"Truman"},"56081":{"lat":43.9828,"lng":-94.6267,"city":"St. James"},
        "56187":{"lat":43.6199,"lng":-95.5964,"city":"Worthington"},"56101":{"lat":43.8664,"lng":-95.1172,"city":"Windom"},
        "56258":{"lat":44.4469,"lng":-95.7886,"city":"Marshall"},"56071":{"lat":44.5428,"lng":-94.3650,"city":"St. Peter"},
        "56093":{"lat":44.0777,"lng":-93.5066,"city":"Waseca"},"56024":{"lat":43.6386,"lng":-94.0981,"city":"Blue Earth"},
        "55927":{"lat":44.0297,"lng":-92.7504,"city":"Dodge Center"},"55972":{"lat":43.9694,"lng":-92.0640,"city":"St. Charles"},
        "55920":{"lat":43.8614,"lng":-93.0514,"city":"Blooming Prairie"},"55975":{"lat":43.6894,"lng":-92.3894,"city":"Spring Valley"},
        "55949":{"lat":43.7642,"lng":-91.5696,"city":"Houston"},"55947":{"lat":43.5092,"lng":-91.4614,"city":"Eitzen"},
        "56267":{"lat":45.5864,"lng":-95.9136,"city":"Morris"},"56201":{"lat":45.1219,"lng":-95.0433,"city":"Willmar"},
        "55352":{"lat":44.5531,"lng":-94.2217,"city":"Gaylord"},"55396":{"lat":44.5428,"lng":-94.3650,"city":"Winthrop"},
        "56164":{"lat":43.6983,"lng":-95.4678,"city":"Brewster"},"56159":{"lat":43.9397,"lng":-94.9281,"city":"Mountain Lake"},
        "56265":{"lat":44.4136,"lng":-94.9253,"city":"Morgan"},"56277":{"lat":44.7889,"lng":-95.2114,"city":"Renville"},
        "56266":{"lat":44.5536,"lng":-94.9856,"city":"Morton"},"55026":{"lat":44.6750,"lng":-92.9650,"city":"Frontenac"},
        "56031":{"lat":43.6480,"lng":-93.3683,"city":"Albert Lea"},"55936":{"lat":43.7057,"lng":-92.5727,"city":"Grand Meadow"},
    };

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê STATE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    let ELEVATORS = [];       // Populated from bids.json
    let bidsLoaded = false;
    let userLat = null, userLng = null, userCity = '';
    let activeFilter = 'all';

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FARMBUCKS SLUG LOOKUP for "View on Farmbucks" links ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    const FB_SLUGS = {
        'alcivia':'alcivia','allied cooperative':'allied-coop','country visions cooperative':'country-visions',
        'united cooperative':'united-coop','ace ethanol':'ace-ethanol','central farm service (cfs)':'cfs',
        'farmers win coop':'farmers-win-coop','farmward cooperative':'farmward','new vision co-op':'new-vision-coop',
        'nexus cooperative':'nexus','ag plus cooperative':'ag-plus','stateline coop':'stateline-coop',
        'adm':'adm','ag processing (agp)':'agp','al-corn clean fuel':'al-corn','poet biorefining':'poet',
        'bunge':'bunge','cargill':'cargill','jennie-o':'jennie-o','michael foods':'michael-foods',
        'green plains':'green-plains',
    };

    function getFarmbucksUrl(elevatorName) {
        const slug = FB_SLUGS[elevatorName.toLowerCase()];
        return slug ? `https://farmbucks.com/grain-prices/${slug}` : null;
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LOAD bids.json ‚Äî THE DATABASE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    async function loadData() {
        try {
            const resp = await fetch('bids.json?t=' + Date.now());
            if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
            const data = await resp.json();

            // Transform bids.json elevators ‚Üí UI format
            ELEVATORS = (data.elevators || []).map(e => {
                const coms = Object.keys(e.bids || {});
                return {
                    name: e.elevator,
                    city: e.city,
                    state: e.state,
                    lat: e.lat || null,
                    lng: e.lng || null,
                    type: e.type || 'coop',
                    source: e.source || 'farmbucks',
                    com: coms,
                    bids: e.bids || {},
                };
            }).filter(e => e.lat && e.lng); // Only show elevators with coordinates

            bidsLoaded = true;

            // Update stats
            document.getElementById('totalCount').textContent = ELEVATORS.length;

            // Show timestamp
            const tsEl = document.getElementById('bids-updated');
            if (tsEl && data.generated) {
                const d = new Date(data.generated);
                tsEl.textContent = 'Updated: ' + d.toLocaleString('en-US', {month:'short',day:'numeric',hour:'numeric',minute:'2-digit',timeZoneName:'short'});
                tsEl.style.display = 'inline';
            }

            console.log(`[AGSIST] Loaded ${ELEVATORS.length} elevators from bids.json (sources: ${(data.sources||[]).join(', ')})`);
            rerender();

        } catch(err) {
            console.warn('[AGSIST] Could not load bids.json:', err.message);
            document.getElementById('totalCount').textContent = '0';
            document.getElementById('elevator-list').innerHTML = `
                <div class="no-results">
                    <h3>‚è≥ Bid data not available yet</h3>
                    <p>The scraper hasn't run yet or bids.json is missing.<br>
                    Run <code>python scrape_bids.py</code> to generate data, or check back soon.</p>
                    <p style="margin-top:12px;">In the meantime, try these direct links:</p>
                    <div style="display:flex;gap:8px;justify-content:center;flex-wrap:wrap;margin-top:12px;">
                        <a href="https://farmbucks.com/grain-prices/allied-coop" target="_blank" class="bid-link">Allied Coop</a>
                        <a href="https://farmbucks.com/grain-prices/alcivia/wisconsin" target="_blank" class="bid-link">ALCIVIA</a>
                        <a href="https://farmbucks.com/grain-prices/united-coop/wisconsin" target="_blank" class="bid-link">United Coop</a>
                        <a href="https://farmbucks.com/grain-prices/country-visions" target="_blank" class="bid-link">Country Visions</a>
                    </div>
                </div>`;
        }
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HAVERSINE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    function haversine(lat1,lng1,lat2,lng2) {
        const R = 3958.8;
        const dLat = (lat2-lat1)*Math.PI/180;
        const dLng = (lng2-lng1)*Math.PI/180;
        const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLng/2)**2;
        return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SEARCH ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    function searchByZip() {
        const zip = document.getElementById('zipInput').value.trim();
        if (!/^\d{5}$/.test(zip)) { alert('Enter a valid 5-digit zip code'); return; }

        const entry = ZIP_DB[zip];
        if (entry) {
            userLat = entry.lat; userLng = entry.lng; userCity = entry.city;
            rerender();
        } else {
            document.getElementById('geoStatus').innerHTML = '<span class="spinner"></span> Looking up zip code...';
            fetch(`https://nominatim.openstreetmap.org/search?postalcode=${zip}&country=US&format=json&limit=1`, {headers:{'User-Agent':'AGSIST/1.0'}})
                .then(r=>r.json()).then(data=>{
                    if(data.length){
                        userLat=parseFloat(data[0].lat); userLng=parseFloat(data[0].lon);
                        userCity=data[0].display_name.split(',')[0];
                        rerender();
                    } else { document.getElementById('geoStatus').textContent='Zip not found. Try another.'; }
                }).catch(()=>{ document.getElementById('geoStatus').textContent='Lookup failed. Try again.'; });
        }
    }

    function quickZip(zip) {
        document.getElementById('zipInput').value = zip;
        searchByZip();
    }

    function useMyLocation() {
        if (!navigator.geolocation) { alert('Geolocation not supported'); return; }
        document.getElementById('geoStatus').innerHTML = '<span class="spinner"></span> Detecting location...';
        navigator.geolocation.getCurrentPosition(pos => {
            userLat = pos.coords.latitude; userLng = pos.coords.longitude;
            fetch(`https://nominatim.openstreetmap.org/reverse?lat=${userLat}&lon=${userLng}&format=json`,{headers:{'User-Agent':'AGSIST/1.0'}})
                .then(r=>r.json()).then(data=>{
                    userCity = data.address?.city || data.address?.town || data.address?.village || 'Your Location';
                    rerender();
                }).catch(()=>{ userCity='Your Location'; rerender(); });
        }, ()=>{
            document.getElementById('geoStatus').textContent='Location access denied. Enter a zip code instead.';
        }, {timeout:10000});
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FILTER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    function setFilter(f, btn) {
        activeFilter = f;
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        rerender();
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê BID FORMATTING ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    function formatBasis(val) {
        if (val === null || val === undefined || val === '') return null;
        const n = parseFloat(val);
        if (isNaN(n)) return null;
        return (n >= 0 ? '+' : '') + n.toFixed(0) + '¬¢';
    }

    function formatCash(val) {
        if (val === null || val === undefined || val === '') return null;
        const n = parseFloat(val);
        if (isNaN(n)) return null;
        return '$' + n.toFixed(2);
    }

    function renderBidBadges(bids) {
        if (!bids || !Object.keys(bids).length) return '';
        const badges = [];
        const order = ['corn','soy','wheat','oats'];
        for (const c of order) {
            const b = bids[c];
            if (!b) continue;
            const basis = formatBasis(b.basis);
            const cash = formatCash(b.cashPrice);
            if (cash) {
                const emoji = c === 'corn' ? 'üåΩ' : c === 'soy' ? 'ü´ò' : 'üåæ';
                badges.push(`<span class="bid-badge ${c}">${emoji} ${cash}${basis ? ' <small>('+basis+')</small>' : ''}</span>`);
            }
        }
        return badges.length ? `<div class="bid-row">${badges.join(' ')}</div>` : '';
    }

    function renderBidPopup(bids) {
        if (!bids || !Object.keys(bids).length) return '';
        let lines = [];
        const order = ['corn','soy','wheat','oats'];
        for (const c of order) {
            const b = bids[c];
            if (!b) continue;
            const cash = formatCash(b.cashPrice);
            const basis = formatBasis(b.basis);
            if (cash) lines.push(`${c}: ${cash}${basis ? ' ('+basis+')' : ''}`);
        }
        return lines.length ? '<br><strong>üí∞ ' + lines.join(' ¬∑ ') + '</strong>' : '';
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê RENDER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    function rerender() {
        if (!bidsLoaded) return;

        const radius = parseInt(document.getElementById('radiusSelect').value);
        document.getElementById('geoStatus').textContent = '';

        let list = ELEVATORS.map(e => {
            const dist = (userLat && userLng) ? haversine(userLat,userLng,e.lat,e.lng) : null;
            return {...e, dist};
        });

        // Filter by commodity
        if (activeFilter !== 'all') {
            list = list.filter(e => e.com.includes(activeFilter));
        }

        // Filter by radius
        if (userLat && userLng && radius < 999) {
            list = list.filter(e => e.dist !== null && e.dist <= radius);
        }

        // Sort
        if (userLat && userLng) {
            list.sort((a,b) => a.dist - b.dist);
        } else {
            list.sort((a,b) => a.city.localeCompare(b.city));
        }

        // Status bar
        const status = document.getElementById('results-status');
        if (userLat && userLng) {
            status.style.display = 'block';
            status.innerHTML = `Showing <strong>${list.length}</strong> elevator${list.length!==1?'s':''} within <strong>${radius < 999 ? radius+' miles':'all distances'}</strong> of <span class="loc-name">${userCity || 'your location'}</span>` + (activeFilter!=='all' ? ` ¬∑ filtered: <strong>${activeFilter}</strong>` : '');
        } else {
            status.style.display = 'block';
            status.innerHTML = `Showing all <strong>${list.length}</strong> elevators (alphabetical) ‚Äî <span style="color:var(--accent)">enter a zip code or use location for distance sorting</span>`;
        }

        // Render cards
        const container = document.getElementById('elevator-list');
        if (list.length === 0) {
            container.innerHTML = `<div class="no-results"><h3>No elevators found</h3><p>Try a larger radius or different commodity filter.</p></div>`;
            return;
        }

        container.innerHTML = list.map(e => {
            const distStr = e.dist !== null ? `<span class="dist">${e.dist.toFixed(1)} mi</span> ¬∑ ` : '';
            const tags = e.com.map(c => `<span class="elev-tag ${c}">${c}</span>`).join('');
            const typeTag = e.type === 'ethanol' ? '<span class="elev-tag ethanol">ethanol</span>' : e.type === 'processor' ? '<span class="elev-tag processor">processor</span>' : '';

            // Build action links
            let actions = '';
            const fbUrl = getFarmbucksUrl(e.name);
            if (fbUrl) {
                actions += `<a href="${fbUrl}" target="_blank" rel="noopener" class="bid-link">View on Farmbucks ‚Üí</a>`;
            }

            // Bid badges (real prices from scraper)
            const bidLine = renderBidBadges(e.bids);

            // Source badge
            const srcBadge = e.source === 'barchart' ? '<span style="font-size:0.55rem;color:var(--dim);background:var(--bg);padding:1px 6px;border-radius:3px;margin-left:4px;">via Barchart</span>' : '';

            return `<div class="elev-card">
                <div class="elev-info">
                    <div class="elev-name">${e.name}${srcBadge}</div>
                    <div class="elev-loc">${distStr}${e.city}, ${e.state}</div>
                    <div class="elev-tags">${tags}${typeTag}</div>
                    ${bidLine}
                </div>
                <div class="elev-actions">
                    ${actions}
                </div>
            </div>`;
        }).join('');
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ENTER KEY ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    document.getElementById('zipInput').addEventListener('keypress', e => {
        if (e.key === 'Enter') { e.preventDefault(); searchByZip(); }
    });

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MAP ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    let map = null;
    let mapMarkers = [];
    let userMarker = null;
    let currentView = 'list';
    const TYPE_COLORS = { coop:'#4CAF50', elevator:'#2196F3', ethanol:'#FF9800', processor:'#9C27B0' };

    function initMap() {
        if (map) return;
        map = L.map('elevator-map', {
            center: [44.5, -90.5],
            zoom: 7,
            zoomControl: true,
            scrollWheelZoom: true
        });
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://carto.com/">CARTO</a> &copy; <a href="https://osm.org/copyright">OSM</a>',
            subdomains: 'abcd', maxZoom: 18
        }).addTo(map);
    }

    function updateMap() {
        if (!map) return;
        mapMarkers.forEach(m => map.removeLayer(m));
        mapMarkers = [];
        if (userMarker) { map.removeLayer(userMarker); userMarker = null; }

        const radius = parseInt(document.getElementById('radiusSelect').value);
        let list = ELEVATORS.map(e => {
            const dist = (userLat && userLng) ? haversine(userLat,userLng,e.lat,e.lng) : null;
            return {...e, dist};
        });
        if (activeFilter !== 'all') list = list.filter(e => e.com.includes(activeFilter));
        if (userLat && userLng && radius < 999) list = list.filter(e => e.dist !== null && e.dist <= radius);

        const bounds = [];

        list.forEach(e => {
            if (!e.lat || !e.lng) return;
            const color = TYPE_COLORS[e.type] || '#2196F3';
            const marker = L.circleMarker([e.lat, e.lng], {
                radius: 7, fillColor: color, color: '#000', weight: 1, fillOpacity: 0.85
            }).addTo(map);

            let popup = `<strong>${e.name}</strong><br>${e.city}, ${e.state}`;
            if (e.dist !== null) popup += `<br><em>${e.dist.toFixed(1)} mi away</em>`;
            popup += renderBidPopup(e.bids);
            const fbUrl = getFarmbucksUrl(e.name);
            if (fbUrl) popup += `<br><a href="${fbUrl}" target="_blank">View on Farmbucks ‚Üí</a>`;
            marker.bindPopup(popup);
            mapMarkers.push(marker);
            bounds.push([e.lat, e.lng]);
        });

        if (userLat && userLng) {
            userMarker = L.circleMarker([userLat, userLng], {
                radius: 10, fillColor: '#e6b042', color: '#fff', weight: 2, fillOpacity: 1
            }).addTo(map).bindPopup(`<strong>üìç ${userCity || 'Your location'}</strong>`);
            bounds.push([userLat, userLng]);
        }

        if (bounds.length > 0) {
            map.fitBounds(bounds, { padding: [30, 30], maxZoom: 10 });
        }
    }

    function switchView(view) {
        currentView = view;
        const listEl = document.getElementById('elevator-list');
        const statusEl = document.getElementById('results-status');
        const mapEl = document.getElementById('map-container');
        const btnList = document.getElementById('btnListView');
        const btnMap = document.getElementById('btnMapView');

        if (view === 'map') {
            listEl.style.display = 'none';
            statusEl.style.display = 'none';
            mapEl.style.display = 'block';
            btnMap.classList.add('active');
            btnList.classList.remove('active');
            initMap();
            setTimeout(() => { map.invalidateSize(); updateMap(); }, 100);
        } else {
            listEl.style.display = '';
            statusEl.style.display = '';
            mapEl.style.display = 'none';
            btnList.classList.add('active');
            btnMap.classList.remove('active');
        }
    }

    // Patch rerender to also update map
    const _origRerender = rerender;
    rerender = function() {
        _origRerender();
        if (currentView === 'map' && map) updateMap();
    };

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê INIT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    loadData();
    </script>
</body>
</html>
